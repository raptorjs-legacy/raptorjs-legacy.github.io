<!DOCTYPE html><html><head><base href="../../../.."></base><title>Source for /raptor/optimizer/PageOptimizer.js â€” RaptorJS API</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" type="text/css" href="static/jsdoc-64998f32.css">
<link rel="stylesheet" type="text/css" href="static/type-f3fd1b7a.css"></head></html><body><body><div id="nav"><div class="nav jstree-classic" style="visibility: hidden;" id="w0"><div id="search-form"><div class="body"><input type="text" id="searchInput" size="20" value="Search API docs" autocomplete="off" class="ac_input"></div></div><div id="navTree" class="jstree-no-dots"><ul><li id="nav_package_json" class="package"><a href="./source/package.json/">package.json</a> </li><li id="nav_raptor" class="raptor-module"><a href="./raptor/">raptor</a><ul><li id="nav_raptor_package_json" class="package"><a href="./source/raptor/package.json/">package.json</a> </li><li id="nav_raptor_arrays" class="raptor-module"><a href="./raptor/arrays/">arrays</a><ul><li id="nav_raptor_arrays_package_json" class="package"><a href="./source/raptor/arrays/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_caching" class="raptor-module"><a href="./raptor/caching/">caching</a><ul><li id="nav_raptor_caching_package_json" class="package"><a href="./source/raptor/caching/package.json/">package.json</a> </li><li id="nav_raptor_caching_BaseCache" class="raptor-class"><a href="./raptor/caching/BaseCache/">BaseCache</a> </li><li id="nav_raptor_caching_SimpleCache" class="raptor-class"><a href="./raptor/caching/SimpleCache/">SimpleCache</a> </li><li id="nav_raptor_caching_SimpleCacheProvider" class="raptor-class"><a href="./raptor/caching/SimpleCacheProvider/">SimpleCacheProvider</a> </li></ul> </li><li id="nav_raptor_component-renderer" class="raptor-module"><a href="./raptor/component-renderer/">component-renderer</a><ul><li id="nav_raptor_component-renderer_package_json" class="package"><a href="./source/raptor/component-renderer/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_config" class="raptor-module"><a href="./raptor/config/">config</a><ul><li id="nav_raptor_config_package_json" class="package"><a href="./source/raptor/config/package.json/">package.json</a> </li><li id="nav_raptor_config_Config" class="class"><a href="./raptor/config/Config/">configConfig</a> </li></ul> </li><li id="nav_raptor_console" class="folder"><a href="#">console</a><ul><li id="nav_raptor_console_package_json" class="package"><a href="./source/raptor/console/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_cookies" class="raptor-module"><a href="./raptor/cookies/">cookies</a><ul><li id="nav_raptor_cookies_package_json" class="package"><a href="./source/raptor/cookies/package.json/">package.json</a> </li><li id="nav_raptor_cookies_Cookie" class="raptor-class"><a href="./raptor/cookies/Cookie/">Cookie</a> </li><li id="nav_raptor_cookies_CookieManager" class="raptor-class"><a href="./raptor/cookies/CookieManager/">CookieManager</a> </li></ul> </li><li id="nav_raptor_css-minifier" class="raptor-module"><a href="./raptor/css-minifier/">css-minifier</a><ul><li id="nav_raptor_css-minifier_package_json" class="package"><a href="./source/raptor/css-minifier/package.json/">package.json</a> </li><li id="nav_raptor_css-minifier_Node" class="object extension"><a href="./raptor/css-minifier_Node/">Node Extension</a> </li></ul> </li><li id="nav_raptor_css-parser" class="raptor-module"><a href="./raptor/css-parser/">css-parser</a> </li><li id="nav_raptor_data-providers" class="raptor-module"><a href="./raptor/data-providers/">data-providers</a><ul><li id="nav_raptor_data-providers_package_json" class="package"><a href="./source/raptor/data-providers/package.json/">package.json</a> </li><li id="nav_raptor_data-providers_DataProviders" class="raptor-class"><a href="./raptor/data-providers/DataProviders/">DataProviders</a> </li></ul> </li><li id="nav_raptor_debug" class="raptor-module"><a href="./raptor/debug/">debug</a><ul><li id="nav_raptor_debug_package_json" class="package"><a href="./source/raptor/debug/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_dom" class="raptor-module"><a href="./raptor/dom/">dom</a><ul><li id="nav_raptor_dom_package_json" class="package"><a href="./source/raptor/dom/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_ecma" class="folder"><a href="#">ecma</a><ul><li id="nav_raptor_ecma_es5" class="folder"><a href="#">es5</a><ul><li id="nav_raptor_ecma_es5_package_json" class="package"><a href="./source/raptor/ecma/es5/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_ecma_es6" class="folder"><a href="#">es6</a><ul><li id="nav_raptor_ecma_es6_package_json" class="package"><a href="./source/raptor/ecma/es6/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_ecma_JSON" class="folder"><a href="#">JSON</a><ul><li id="nav_raptor_ecma_JSON_package_json" class="package"><a href="./source/raptor/ecma/JSON/package.json/">package.json</a> </li></ul> </li></ul> </li><li id="nav_raptor_file-watcher" class="raptor-module"><a href="./raptor/file-watcher/">file-watcher</a><ul><li id="nav_raptor_file-watcher_package_json" class="package"><a href="./source/raptor/file-watcher/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_files" class="raptor-module"><a href="./raptor/files/">files</a><ul><li id="nav_raptor_files_package_json" class="package"><a href="./source/raptor/files/package.json/">package.json</a> </li><li id="nav_raptor_files_Node" class="object extension"><a href="./raptor/files_Node/">Node Extension</a> </li><li id="nav_raptor_files_Rhino" class="object extension"><a href="./raptor/files_Rhino/">Rhino Extension</a> </li><li id="nav_raptor_files_FileMixins" class="raptor-module"><a href="./raptor/files/FileMixins/">FileMixins</a> </li><li id="nav_raptor_files_walker" class="raptor-module"><a href="./raptor/files/walker/">walker</a><ul><li id="nav_raptor_files_walker_package_json" class="package"><a href="./source/raptor/files/walker/package.json/">package.json</a> </li><li id="nav_raptor_files_walker_DirWalker" class="raptor-class"><a href="./raptor/files/walker/DirWalker/">DirWalker</a> </li></ul> </li><li id="nav_raptor_files_File_Node" class="raptor-class"><a href="./raptor/files/File_Node/">File (Node Extension)</a> </li><li id="nav_raptor_files_File_Rhino" class="raptor-class"><a href="./raptor/files/File_Rhino/">File (Rhino Extension)</a> </li></ul> </li><li id="nav_raptor_i18n" class="raptor-module"><a href="./raptor/i18n/">i18n</a><ul><li id="nav_raptor_i18n_package_json" class="package"><a href="./source/raptor/i18n/package.json/">package.json</a> </li><li id="nav_raptor_i18n_Dictionaries" class="raptor-class"><a href="./raptor/i18n/Dictionaries/">Dictionaries</a> </li><li id="nav_raptor_i18n_Dictionary" class="raptor-class"><a href="./raptor/i18n/Dictionary/">Dictionary</a> </li></ul> </li><li id="nav_raptor_java" class="raptor-module"><a href="./raptor/java/">java</a><ul><li id="nav_raptor_java_package_json" class="package"><a href="./source/raptor/java/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_js-minifier" class="raptor-module"><a href="./raptor/js-minifier/">js-minifier</a><ul><li id="nav_raptor_js-minifier_package_json" class="package"><a href="./source/raptor/js-minifier/package.json/">package.json</a> </li><li id="nav_raptor_js-minifier_Node" class="object extension"><a href="./raptor/js-minifier_Node/">Node Extension</a> </li></ul> </li><li id="nav_raptor_jsdoc" class="raptor-module"><a href="./raptor/jsdoc/">jsdoc</a><ul><li id="nav_raptor_jsdoc_package_json" class="package"><a href="./source/raptor/jsdoc/package.json/">package.json</a> </li><li id="nav_raptor_jsdoc_raptor-plugin" class="raptor-module"><a href="./raptor/jsdoc/raptor-plugin/">raptor-plugin</a> </li><li id="nav_raptor_jsdoc_ASTWalker" class="raptor-class"><a href="./raptor/jsdoc/ASTWalker/">ASTWalker</a> </li><li id="nav_raptor_jsdoc_BorrowTag" class="raptor-class"><a href="./raptor/jsdoc/BorrowTag/">BorrowTag</a> </li><li id="nav_raptor_jsdoc_Comment" class="raptor-class"><a href="./raptor/jsdoc/Comment/">Comment</a> </li><li id="nav_raptor_jsdoc_CommentParser" class="raptor-class"><a href="./raptor/jsdoc/CommentParser/">CommentParser</a> </li><li id="nav_raptor_jsdoc_Environment" class="raptor-class"><a href="./raptor/jsdoc/Environment/">Environment</a> </li><li id="nav_raptor_jsdoc_ParamTag" class="raptor-class"><a href="./raptor/jsdoc/ParamTag/">ParamTag</a> </li><li id="nav_raptor_jsdoc_ReturnTag" class="raptor-class"><a href="./raptor/jsdoc/ReturnTag/">ReturnTag</a> </li><li id="nav_raptor_jsdoc_SymbolSet" class="raptor-class"><a href="./raptor/jsdoc/SymbolSet/">SymbolSet</a> </li><li id="nav_raptor_jsdoc_Tag" class="raptor-class"><a href="./raptor/jsdoc/Tag/">Tag</a> </li><li id="nav_raptor_jsdoc_Type" class="raptor-class"><a href="./raptor/jsdoc/Type/">Type</a> </li></ul> </li><li id="nav_raptor_json" class="raptor-module"><a href="./raptor/json/">json</a><ul><li id="nav_raptor_json_package_json" class="package"><a href="./source/raptor/json/package.json/">package.json</a> </li><li id="nav_raptor_json_jQuery_Parse" class="object extension"><a href="./raptor/json_jQuery_Parse/">jQuery Parse Extension</a> </li><li id="nav_raptor_json_Raptor_Parse" class="object extension"><a href="./raptor/json_Raptor_Parse/">Raptor Parse Extension</a> </li><li id="nav_raptor_json_Raptor_Stringify" class="object extension"><a href="./raptor/json_Raptor_Stringify/">Raptor Stringify Extension</a> </li><li id="nav_raptor_json_parse" class="raptor-module"><a href="./raptor/json/parse/">parse</a><ul><li id="nav_raptor_json_parse_package_json" class="package"><a href="./source/raptor/json/parse/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_json_stringify" class="raptor-module"><a href="./raptor/json/stringify/">stringify</a><ul><li id="nav_raptor_json_stringify_package_json" class="package"><a href="./source/raptor/json/stringify/package.json/">package.json</a> </li></ul> </li></ul> </li><li id="nav_raptor_listeners" class="raptor-module"><a href="./raptor/listeners/">listeners</a><ul><li id="nav_raptor_listeners_package_json" class="package"><a href="./source/raptor/listeners/package.json/">package.json</a> </li><li id="nav_raptor_listeners_ListenerHandle" class="object"><a href="./raptor/listeners/ListenerHandle/">ListenerHandle</a> </li><li id="nav_raptor_listeners_Listeners" class="class"><a href="./raptor/listeners/Listeners/">Listeners</a> </li><li id="nav_raptor_listeners_Message" class="class"><a href="./raptor/listeners/Message/">Message</a> </li><li id="nav_raptor_listeners_Observable" class="class"><a href="./raptor/listeners/Observable/">Observable</a> </li></ul> </li><li id="nav_raptor_loader" class="raptor-module"><a href="./raptor/loader/">loader</a><ul><li id="nav_raptor_loader_package_json" class="package"><a href="./source/raptor/loader/package.json/">package.json</a> </li><li id="nav_raptor_loader_Browser" class="object extension"><a href="./raptor/loader_Browser/">Browser Extension</a> </li><li id="nav_raptor_loader_jQuery" class="object extension"><a href="./raptor/loader_jQuery/">jQuery Extension</a> </li><li id="nav_raptor_loader_Module_Loader" class="object extension"><a href="./raptor/loader_Module_Loader/">Module Loader Extension</a> </li><li id="nav_raptor_loader_Raptor" class="object extension"><a href="./raptor/loader_Raptor/">Raptor Extension</a> </li><li id="nav_raptor_loader_require" class="folder"><a href="#">require</a><ul><li id="nav_raptor_loader_require_package_json" class="package"><a href="./source/raptor/loader/require/package.json/">package.json</a> </li></ul> </li></ul> </li><li id="nav_raptor_locale" class="folder"><a href="#">locale</a><ul><li id="nav_raptor_locale_formatting" class="folder"><a href="#">formatting</a><ul><li id="nav_raptor_locale_formatting_numbers" class="raptor-module"><a href="./raptor/locale/formatting/numbers/">numbers</a><ul><li id="nav_raptor_locale_formatting_numbers_package_json" class="package"><a href="./source/raptor/locale/formatting/numbers/package.json/">package.json</a> </li><li id="nav_raptor_locale_formatting_numbers_NumberFormatter" class="class"><a href="./raptor/locale/formatting/numbers/NumberFormatter/">NumberFormatter</a> </li></ul> </li></ul> </li></ul> </li><li id="nav_raptor_logging" class="raptor-module"><a href="./raptor/logging/">logging</a><ul><li id="nav_raptor_logging_package_json" class="package"><a href="./source/raptor/logging/package.json/">package.json</a> </li><li id="nav_raptor_logging_Console" class="object extension"><a href="./raptor/logging_Console/">Console Extension</a> </li><li id="nav_raptor_logging_ConsoleAppender" class="raptor-class"><a href="./raptor/logging/ConsoleAppender/">ConsoleAppender</a> </li><li id="nav_raptor_logging_Logger" class="raptor-class"><a href="./raptor/logging/Logger/">Logger</a> </li><li id="nav_raptor_logging_voidLogger" class="object"><a href="./raptor/logging/voidLogger/">voidLogger</a> </li></ul> </li><li id="nav_raptor_lookup" class="raptor-module"><a href="./raptor/lookup/">lookup</a><ul><li id="nav_raptor_lookup_package_json" class="package"><a href="./source/raptor/lookup/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_mime" class="raptor-module"><a href="./raptor/mime/">mime</a><ul><li id="nav_raptor_mime_package_json" class="package"><a href="./source/raptor/mime/package.json/">package.json</a> </li><li id="nav_raptor_mime_Node" class="object extension"><a href="./raptor/mime_Node/">Node Extension</a> </li></ul> </li><li id="nav_raptor_objects" class="raptor-module"><a href="./raptor/objects/">objects</a><ul><li id="nav_raptor_objects_package_json" class="package"><a href="./source/raptor/objects/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_optimizer" class="raptor-module"><a href="./raptor/optimizer/">optimizer</a><ul><li id="nav_raptor_optimizer_cli" class="raptor-module"><a href="./raptor/optimizer/cli/">cli</a><ul><li id="nav_raptor_optimizer_cli_package_json" class="package"><a href="./source/raptor/optimizer/cli/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_optimizer_i18n" class="raptor-module"><a href="./raptor/optimizer/i18n/">i18n</a><ul><li id="nav_raptor_optimizer_i18n_i18n-compiler" class="raptor-module"><a href="./raptor/optimizer/i18n/i18n-compiler/">i18n-compiler</a> </li><li id="nav_raptor_optimizer_i18n_I18nContext" class="raptor-class"><a href="./raptor/optimizer/i18n/I18nContext/">I18nContext</a> </li></ul> </li><li id="nav_raptor_optimizer_MinifyCSSFilter" class="raptor-module"><a href="./raptor/optimizer/MinifyCSSFilter/">MinifyCSSFilter</a> </li><li id="nav_raptor_optimizer_MinifyJSFilter" class="raptor-module"><a href="./raptor/optimizer/MinifyJSFilter/">MinifyJSFilter</a> </li><li id="nav_raptor_optimizer_ResolveCSSUrlsFilter" class="raptor-module"><a href="./raptor/optimizer/ResolveCSSUrlsFilter/">ResolveCSSUrlsFilter</a> </li><li id="nav_raptor_optimizer_Bundle" class="raptor-class"><a href="./raptor/optimizer/Bundle/">Bundle</a> </li><li id="nav_raptor_optimizer_BundleConfig" class="raptor-class"><a href="./raptor/optimizer/BundleConfig/">BundleConfig</a> </li><li id="nav_raptor_optimizer_BundleMappings" class="raptor-class"><a href="./raptor/optimizer/BundleMappings/">BundleMappings</a> </li><li id="nav_raptor_optimizer_BundleSetConfig" class="raptor-class"><a href="./raptor/optimizer/BundleSetConfig/">BundleSetConfig</a> </li><li id="nav_raptor_optimizer_Cache" class="raptor-class"><a href="./raptor/optimizer/Cache/">Cache</a> </li><li id="nav_raptor_optimizer_Config" class="raptor-class"><a href="./raptor/optimizer/Config/">Config</a> </li><li id="nav_raptor_optimizer_ConfigXmlParser" class="raptor-class"><a href="./raptor/optimizer/ConfigXmlParser/">ConfigXmlParser</a> </li><li id="nav_raptor_optimizer_FileUrlBuilder" class="raptor-class"><a href="./raptor/optimizer/FileUrlBuilder/">FileUrlBuilder</a> </li><li id="nav_raptor_optimizer_HtmlInjector" class="raptor-class"><a href="./raptor/optimizer/HtmlInjector/">HtmlInjector</a> </li><li id="nav_raptor_optimizer_OptimizedPage" class="raptor-class"><a href="./raptor/optimizer/OptimizedPage/">OptimizedPage</a> </li><li id="nav_raptor_optimizer_OptimizerFileWriter" class="raptor-class"><a href="./raptor/optimizer/OptimizerFileWriter/">OptimizerFileWriter</a> </li><li id="nav_raptor_optimizer_OptimizerRenderContext" class="raptor-class"><a href="./raptor/optimizer/OptimizerRenderContext/">OptimizerRenderContext</a> </li><li id="nav_raptor_optimizer_OptimizerWriterMixins" class="raptor-class"><a href="./raptor/optimizer/OptimizerWriterMixins/">OptimizerWriterMixins</a> </li><li id="nav_raptor_optimizer_PageBundles" class="raptor-class"><a href="./raptor/optimizer/PageBundles/">PageBundles</a><ul><li id="nav_raptor_optimizer_PageBundles_AsyncRequire" class="class"><a href="./raptor/optimizer/PageBundles/AsyncRequire/">AsyncRequire</a> </li></ul> </li><li id="nav_raptor_optimizer_PageConfig" class="raptor-class"><a href="./raptor/optimizer/PageConfig/">PageConfig</a> </li><li id="nav_raptor_optimizer_PageOptimizer" class="raptor-class"><a href="./raptor/optimizer/PageOptimizer/">PageOptimizer</a> </li><li id="nav_raptor_optimizer_Slot" class="raptor-class"><a href="./raptor/optimizer/Slot/">Slot</a> </li><li id="nav_raptor_optimizer_SlotTracker" class="raptor-class"><a href="./raptor/optimizer/SlotTracker/">SlotTracker</a> </li></ul> </li><li id="nav_raptor_packaging" class="raptor-module"><a href="./raptor/packaging/">packaging</a><ul><li id="nav_raptor_packaging_Rhino" class="object extension"><a href="./raptor/packaging_Rhino/">Rhino Extension</a> </li><li id="nav_raptor_packaging_DependencyWalker" class="raptor-module"><a href="./raptor/packaging/DependencyWalker/">DependencyWalker</a> </li><li id="nav_raptor_packaging_Dependency" class="raptor-class"><a href="./raptor/packaging/Dependency/">Dependency</a> </li><li id="nav_raptor_packaging_Dependency_coffee" class="raptor-class"><a href="./raptor/packaging/Dependency_coffee/">Dependency_coffee</a> </li><li id="nav_raptor_packaging_Dependency_css" class="raptor-class"><a href="./raptor/packaging/Dependency_css/">Dependency_css</a> </li><li id="nav_raptor_packaging_Dependency_define" class="raptor-class"><a href="./raptor/packaging/Dependency_define/">Dependency_define</a> </li><li id="nav_raptor_packaging_Dependency_dust" class="raptor-class"><a href="./raptor/packaging/Dependency_dust/">Dependency_dust</a> </li><li id="nav_raptor_packaging_Dependency_i18n" class="raptor-class"><a href="./raptor/packaging/Dependency_i18n/">Dependency_i18n</a> </li><li id="nav_raptor_packaging_Dependency_i18n-module" class="raptor-class"><a href="./raptor/packaging/Dependency_i18n-module/">Dependency_i18n-module</a> </li><li id="nav_raptor_packaging_Dependency_js" class="raptor-class"><a href="./raptor/packaging/Dependency_js/">Dependency_js</a> </li><li id="nav_raptor_packaging_Dependency_less" class="raptor-class"><a href="./raptor/packaging/Dependency_less/">Dependency_less</a> </li><li id="nav_raptor_packaging_Dependency_loader-metadata" class="raptor-class"><a href="./raptor/packaging/Dependency_loader-metadata/">Dependency_loader-metadata</a> </li><li id="nav_raptor_packaging_Dependency_module" class="raptor-class"><a href="./raptor/packaging/Dependency_module/">Dependency_module</a> </li><li id="nav_raptor_packaging_Dependency_package" class="raptor-class"><a href="./raptor/packaging/Dependency_package/">Dependency_package</a> </li><li id="nav_raptor_packaging_Dependency_resource" class="raptor-class"><a href="./raptor/packaging/Dependency_resource/">Dependency_resource</a> </li><li id="nav_raptor_packaging_Dependency_rhtml" class="raptor-class"><a href="./raptor/packaging/Dependency_rhtml/">Dependency_rhtml</a> </li><li id="nav_raptor_packaging_Dependency_rtld" class="raptor-class"><a href="./raptor/packaging/Dependency_rtld/">Dependency_rtld</a> </li><li id="nav_raptor_packaging_ExtensionCollection" class="raptor-class"><a href="./raptor/packaging/ExtensionCollection/">ExtensionCollection</a> </li><li id="nav_raptor_packaging_PackageLoader" class="raptor-class"><a href="./raptor/packaging/PackageLoader/">PackageLoader</a> </li><li id="nav_raptor_packaging_PackageManifest" class="raptor-class"><a href="./raptor/packaging/PackageManifest/">PackageManifest</a> </li></ul> </li><li id="nav_raptor_paths" class="raptor-module"><a href="./raptor/paths/">paths</a><ul><li id="nav_raptor_paths_package_json" class="package"><a href="./source/raptor/paths/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_process" class="raptor-module"><a href="./raptor/process/">process</a><ul><li id="nav_raptor_process_package_json" class="package"><a href="./source/raptor/process/package.json/">package.json</a> </li><li id="nav_raptor_process__Node" class="object extension"><a href="./raptor/process__Node/"> Node Extension</a> </li></ul> </li><li id="nav_raptor_promises" class="raptor-module"><a href="./raptor/promises/">promises</a><ul><li id="nav_raptor_promises_package_json" class="package"><a href="./source/raptor/promises/package.json/">package.json</a> </li><li id="nav_raptor_promises_Node" class="object extension"><a href="./raptor/promises_Node/">Node Extension</a> </li></ul> </li><li id="nav_raptor_pubsub" class="raptor-module"><a href="./raptor/pubsub/">pubsub</a><ul><li id="nav_raptor_pubsub_package_json" class="package"><a href="./source/raptor/pubsub/package.json/">package.json</a> </li><li id="nav_raptor_pubsub_Channel" class="raptor-class"><a href="./raptor/pubsub/Channel/">Channel</a> </li><li id="nav_raptor_pubsub_Message" class="raptor-class"><a href="./raptor/pubsub/Message/">Message</a> </li></ul> </li><li id="nav_raptor_regexp" class="raptor-module"><a href="./raptor/regexp/">regexp</a><ul><li id="nav_raptor_regexp_package_json" class="package"><a href="./source/raptor/regexp/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_render-context" class="raptor-module"><a href="./raptor/render-context/">render-context</a><ul><li id="nav_raptor_render-context_async-package_json" class="package"><a href="./source/raptor/render-context/async-package.json/">async-package.json</a> </li><li id="nav_raptor_render-context_package_json" class="package"><a href="./source/raptor/render-context/package.json/">package.json</a> </li><li id="nav_raptor_render-context_Context" class="raptor-class"><a href="./raptor/render-context/Context/">Context</a> </li></ul> </li><li id="nav_raptor_renderer" class="raptor-module"><a href="./raptor/renderer/">renderer</a><ul><li id="nav_raptor_renderer_package_json" class="package"><a href="./source/raptor/renderer/package.json/">package.json</a> </li><li id="nav_raptor_renderer_RenderResult" class="raptor-class"><a href="./raptor/renderer/RenderResult/">RenderResult</a> </li></ul> </li><li id="nav_raptor_resources" class="raptor-module"><a href="./raptor/resources/">resources</a><ul><li id="nav_raptor_resources_package_json" class="package"><a href="./source/raptor/resources/package.json/">package.json</a> </li><li id="nav_raptor_resources_Browser" class="object extension"><a href="./raptor/resources_Browser/">Browser Extension</a> </li><li id="nav_raptor_resources_Server" class="object extension"><a href="./raptor/resources_Server/">Server Extension</a> </li><li id="nav_raptor_resources_walker" class="raptor-module"><a href="./raptor/resources/walker/">walker</a><ul><li id="nav_raptor_resources_walker_package_json" class="package"><a href="./source/raptor/resources/walker/package.json/">package.json</a> </li><li id="nav_raptor_resources_walker_DirWalker" class="raptor-class"><a href="./raptor/resources/walker/DirWalker/">DirWalker</a> </li></ul> </li><li id="nav_raptor_resources_BrowserResource" class="raptor-class"><a href="./raptor/resources/BrowserResource/">BrowserResource</a> </li><li id="nav_raptor_resources_DirSearchPathEntry" class="raptor-class"><a href="./raptor/resources/DirSearchPathEntry/">DirSearchPathEntry</a> </li><li id="nav_raptor_resources_FileResource" class="raptor-class"><a href="./raptor/resources/FileResource/">FileResource</a> </li><li id="nav_raptor_resources_MissingResource" class="raptor-class"><a href="./raptor/resources/MissingResource/">MissingResource</a> </li><li id="nav_raptor_resources_Resource" class="raptor-class"><a href="./raptor/resources/Resource/">Resource</a> </li><li id="nav_raptor_resources_RhinoResMgrSearchPathEntryAdapter" class="raptor-class"><a href="./raptor/resources/RhinoResMgrSearchPathEntryAdapter/">RhinoResMgrSearchPathEntryAdapter</a> </li><li id="nav_raptor_resources_RhinoResourceAdapter" class="raptor-class"><a href="./raptor/resources/RhinoResourceAdapter/">RhinoResourceAdapter</a><ul><li id="nav_raptor_resources_RhinoResourceAdapter_Watcher" class="class"><a href="./raptor/resources/RhinoResourceAdapter/Watcher/">Watcher</a> </li></ul> </li><li id="nav_raptor_resources_RhinoSearchPathEntryAdapter" class="raptor-class"><a href="./raptor/resources/RhinoSearchPathEntryAdapter/">RhinoSearchPathEntryAdapter</a> </li><li id="nav_raptor_resources_SearchPath" class="raptor-class"><a href="./raptor/resources/SearchPath/">SearchPath</a> </li><li id="nav_raptor_resources_SearchPathEntry" class="raptor-class"><a href="./raptor/resources/SearchPathEntry/">SearchPathEntry</a> </li></ul> </li><li id="nav_raptor_runtime" class="raptor-module"><a href="./raptor/runtime/">runtime</a><ul><li id="nav_raptor_runtime_package_json" class="package"><a href="./source/raptor/runtime/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_stacktraces" class="folder"><a href="#">stacktraces</a><ul><li id="nav_raptor_stacktraces_package_json" class="package"><a href="./source/raptor/stacktraces/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_stacktraces_Browser" class="raptor-module"><a href="./raptor/stacktraces_Browser/">stacktraces (Browser Extension)</a> </li><li id="nav_raptor_stacktraces_Node" class="raptor-module"><a href="./raptor/stacktraces_Node/">stacktraces (Node Extension)</a> </li><li id="nav_raptor_stacktraces_Rhino" class="raptor-module"><a href="./raptor/stacktraces_Rhino/">stacktraces (Rhino Extension)</a> </li><li id="nav_raptor_strings" class="raptor-module"><a href="./raptor/strings/">strings</a><ul><li id="nav_raptor_strings_package_json" class="package"><a href="./source/raptor/strings/package.json/">package.json</a> </li><li id="nav_raptor_strings_StringBuilder" class="raptor-class"><a href="./raptor/strings/StringBuilder/">StringBuilder</a> </li></ul> </li><li id="nav_raptor_temp" class="raptor-module"><a href="./raptor/temp/">temp</a><ul><li id="nav_raptor_temp_package_json" class="package"><a href="./source/raptor/temp/package.json/">package.json</a> </li></ul> </li><li id="nav_raptor_templating" class="raptor-module"><a href="./raptor/templating/">templating</a><ul><li id="nav_raptor_templating_async-package_json" class="package"><a href="./source/raptor/templating/async-package.json/">async-package.json</a> </li><li id="nav_raptor_templating_package_json" class="package"><a href="./source/raptor/templating/package.json/">package.json</a> </li><li id="nav_raptor_templating_Async" class="object extension"><a href="./raptor/templating_Async/">Async Extension</a> </li><li id="nav_raptor_templating_Rhino" class="object extension"><a href="./raptor/templating_Rhino/">Rhino Extension</a> </li><li id="nav_raptor_templating_Server" class="object extension"><a href="./raptor/templating_Server/">Server Extension</a> </li><li id="nav_raptor_templating_compiler" class="raptor-module"><a href="./raptor/templating/compiler/">compiler</a><ul><li id="nav_raptor_templating_compiler_package_json" class="package"><a href="./source/raptor/templating/compiler/package.json/">package.json</a> </li><li id="nav_raptor_templating_compiler_Rhino" class="object extension"><a href="./raptor/templating/compiler_Rhino/">Rhino Extension</a> </li><li id="nav_raptor_templating_compiler_Server" class="object extension"><a href="./raptor/templating/compiler_Server/">Server Extension</a> </li><li id="nav_raptor_templating_compiler_AttributeSplitter" class="raptor-class"><a href="./raptor/templating/compiler/AttributeSplitter/">AttributeSplitter</a> </li><li id="nav_raptor_templating_compiler_ElementNode" class="raptor-class"><a href="./raptor/templating/compiler/ElementNode/">ElementNode</a> </li><li id="nav_raptor_templating_compiler_Expression" class="raptor-class"><a href="./raptor/templating/compiler/Expression/">Expression</a> </li><li id="nav_raptor_templating_compiler_ExpressionParser" class="raptor-class"><a href="./raptor/templating/compiler/ExpressionParser/">ExpressionParser</a><ul><li id="nav_raptor_templating_compiler_ExpressionParser_ExpressionParserHelper" class="raptor-class"><a href="./raptor/templating/compiler/ExpressionParser/ExpressionParserHelper/">ExpressionParserHelper</a> </li></ul> </li><li id="nav_raptor_templating_compiler_Node" class="raptor-class"><a href="./raptor/templating/compiler/Node/">Node</a> </li><li id="nav_raptor_templating_compiler_ParseTreeBuilder" class="raptor-class"><a href="./raptor/templating/compiler/ParseTreeBuilder/">ParseTreeBuilder</a> </li><li id="nav_raptor_templating_compiler_Taglib" class="raptor-class"><a href="./raptor/templating/compiler/Taglib/">Taglib</a> </li><li id="nav_raptor_templating_compiler_TaglibCollection" class="raptor-class"><a href="./raptor/templating/compiler/TaglibCollection/">TaglibCollection</a><ul><li id="nav_raptor_templating_compiler_TaglibCollection_Imports" class="class"><a href="./raptor/templating/compiler/TaglibCollection/Imports/">Imports</a> </li></ul> </li><li id="nav_raptor_templating_compiler_TaglibXmlLoader" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/">TaglibXmlLoader</a><ul><li id="nav_raptor_templating_compiler_TaglibXmlLoader_Attribute" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/Attribute/">Attribute</a> </li><li id="nav_raptor_templating_compiler_TaglibXmlLoader_Function" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/Function/">Function</a> </li><li id="nav_raptor_templating_compiler_TaglibXmlLoader_HelperObject" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/HelperObject/">HelperObject</a> </li><li id="nav_raptor_templating_compiler_TaglibXmlLoader_ImportedVariable" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/ImportedVariable/">ImportedVariable</a> </li><li id="nav_raptor_templating_compiler_TaglibXmlLoader_NestedVariable" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/NestedVariable/">NestedVariable</a> </li><li id="nav_raptor_templating_compiler_TaglibXmlLoader_Property" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/Property/">Property</a> </li><li id="nav_raptor_templating_compiler_TaglibXmlLoader_Tag" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/Tag/">Tag</a> </li><li id="nav_raptor_templating_compiler_TaglibXmlLoader_Transformer" class="raptor-class"><a href="./raptor/templating/compiler/TaglibXmlLoader/Transformer/">Transformer</a> </li></ul> </li><li id="nav_raptor_templating_compiler_TemplateBuilder" class="raptor-class"><a href="./raptor/templating/compiler/TemplateBuilder/">TemplateBuilder</a><ul><li id="nav_raptor_templating_compiler_TemplateBuilder_CodeWriter" class="class"><a href="./raptor/templating/compiler/TemplateBuilder/CodeWriter/">CodeWriter</a> </li></ul> </li><li id="nav_raptor_templating_compiler_TemplateCompiler" class="raptor-class"><a href="./raptor/templating/compiler/TemplateCompiler/">TemplateCompiler</a> </li><li id="nav_raptor_templating_compiler_TextNode" class="raptor-class"><a href="./raptor/templating/compiler/TextNode/">TextNode</a> </li><li id="nav_raptor_templating_compiler_TypeConverter" class="raptor-class"><a href="./raptor/templating/compiler/TypeConverter/">TypeConverter</a> </li></ul> </li><li id="nav_raptor_templating_taglibs" class="folder"><a href="#">taglibs</a><ul><li id="nav_raptor_templating_taglibs_async" class="folder"><a href="#">async</a><ul><li id="nav_raptor_templating_taglibs_async_package_json" class="package"><a href="./source/raptor/templating/taglibs/async/package.json/">package.json</a> </li><li id="nav_raptor_templating_taglibs_async_AsyncFragmentTag" class="raptor-module"><a href="./raptor/templating/taglibs/async/AsyncFragmentTag/">AsyncFragmentTag</a> </li><li id="nav_raptor_templating_taglibs_async_AsyncFragmentTagTransformer" class="raptor-module"><a href="./raptor/templating/taglibs/async/AsyncFragmentTagTransformer/">AsyncFragmentTagTransformer</a> </li></ul> </li><li id="nav_raptor_templating_taglibs_caching" class="folder"><a href="#">caching</a><ul><li id="nav_raptor_templating_taglibs_caching_package_json" class="package"><a href="./source/raptor/templating/taglibs/caching/package.json/">package.json</a> </li><li id="nav_raptor_templating_taglibs_caching_CachedFragmentTag" class="raptor-module"><a href="./raptor/templating/taglibs/caching/CachedFragmentTag/">CachedFragmentTag</a> </li></ul> </li><li id="nav_raptor_templating_taglibs_core" class="folder"><a href="#">core</a><ul><li id="nav_raptor_templating_taglibs_core_compile-time-package_json" class="package"><a href="./source/raptor/templating/taglibs/core/compile-time-package.json/">compile-time-package.json</a> </li><li id="nav_raptor_templating_taglibs_core_AssignNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/AssignNode/">AssignNode</a> </li><li id="nav_raptor_templating_taglibs_core_ChooseNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/ChooseNode/">ChooseNode</a> </li><li id="nav_raptor_templating_taglibs_core_CoreTagTransformer" class="raptor-class"><a href="./raptor/templating/taglibs/core/CoreTagTransformer/">CoreTagTransformer</a> </li><li id="nav_raptor_templating_taglibs_core_CoreTextTransformer" class="raptor-class"><a href="./raptor/templating/taglibs/core/CoreTextTransformer/">CoreTextTransformer</a> </li><li id="nav_raptor_templating_taglibs_core_DefNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/DefNode/">DefNode</a> </li><li id="nav_raptor_templating_taglibs_core_ElseIfNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/ElseIfNode/">ElseIfNode</a> </li><li id="nav_raptor_templating_taglibs_core_ElseNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/ElseNode/">ElseNode</a> </li><li id="nav_raptor_templating_taglibs_core_ElseTagTransformer" class="raptor-class"><a href="./raptor/templating/taglibs/core/ElseTagTransformer/">ElseTagTransformer</a> </li><li id="nav_raptor_templating_taglibs_core_ForNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/ForNode/">ForNode</a> </li><li id="nav_raptor_templating_taglibs_core_IfNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/IfNode/">IfNode</a> </li><li id="nav_raptor_templating_taglibs_core_IncludeNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/IncludeNode/">IncludeNode</a> </li><li id="nav_raptor_templating_taglibs_core_InvokeNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/InvokeNode/">InvokeNode</a> </li><li id="nav_raptor_templating_taglibs_core_OtherwiseNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/OtherwiseNode/">OtherwiseNode</a> </li><li id="nav_raptor_templating_taglibs_core_ScriptletNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/ScriptletNode/">ScriptletNode</a> </li><li id="nav_raptor_templating_taglibs_core_TagHandlerNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/TagHandlerNode/">TagHandlerNode</a> </li><li id="nav_raptor_templating_taglibs_core_TemplateNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/TemplateNode/">TemplateNode</a> </li><li id="nav_raptor_templating_taglibs_core_VarNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/VarNode/">VarNode</a> </li><li id="nav_raptor_templating_taglibs_core_WhenNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/WhenNode/">WhenNode</a> </li><li id="nav_raptor_templating_taglibs_core_WithNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/WithNode/">WithNode</a> </li><li id="nav_raptor_templating_taglibs_core_WriteNode" class="raptor-class"><a href="./raptor/templating/taglibs/core/WriteNode/">WriteNode</a> </li></ul> </li><li id="nav_raptor_templating_taglibs_html" class="folder"><a href="#">html</a><ul><li id="nav_raptor_templating_taglibs_html_compile-time-package_json" class="package"><a href="./source/raptor/templating/taglibs/html/compile-time-package.json/">compile-time-package.json</a> </li><li id="nav_raptor_templating_taglibs_html_CommentTag" class="raptor-module"><a href="./raptor/templating/taglibs/html/CommentTag/">CommentTag</a> </li><li id="nav_raptor_templating_taglibs_html_DocTypeNode" class="raptor-class"><a href="./raptor/templating/taglibs/html/DocTypeNode/">DocTypeNode</a> </li><li id="nav_raptor_templating_taglibs_html_HtmlTagTransformer" class="raptor-class"><a href="./raptor/templating/taglibs/html/HtmlTagTransformer/">HtmlTagTransformer</a> </li></ul> </li><li id="nav_raptor_templating_taglibs_layout" class="folder"><a href="#">layout</a><ul><li id="nav_raptor_templating_taglibs_layout_package_json" class="package"><a href="./source/raptor/templating/taglibs/layout/package.json/">package.json</a> </li><li id="nav_raptor_templating_taglibs_layout_PlaceholderTag" class="raptor-module"><a href="./raptor/templating/taglibs/layout/PlaceholderTag/">PlaceholderTag</a> </li><li id="nav_raptor_templating_taglibs_layout_PutTag" class="raptor-module"><a href="./raptor/templating/taglibs/layout/PutTag/">PutTag</a> </li><li id="nav_raptor_templating_taglibs_layout_UseTag" class="raptor-module"><a href="./raptor/templating/taglibs/layout/UseTag/">UseTag</a> </li></ul> </li><li id="nav_raptor_templating_taglibs_optimizer" class="folder"><a href="#">optimizer</a><ul><li id="nav_raptor_templating_taglibs_optimizer_package_json" class="package"><a href="./source/raptor/templating/taglibs/optimizer/package.json/">package.json</a> </li><li id="nav_raptor_templating_taglibs_optimizer_DependenciesTag" class="raptor-module"><a href="./raptor/templating/taglibs/optimizer/DependenciesTag/">DependenciesTag</a> </li><li id="nav_raptor_templating_taglibs_optimizer_DependencyTag" class="raptor-module"><a href="./raptor/templating/taglibs/optimizer/DependencyTag/">DependencyTag</a> </li><li id="nav_raptor_templating_taglibs_optimizer_DisableExtensionTag" class="raptor-module"><a href="./raptor/templating/taglibs/optimizer/DisableExtensionTag/">DisableExtensionTag</a> </li><li id="nav_raptor_templating_taglibs_optimizer_EnableExtensionTag" class="raptor-module"><a href="./raptor/templating/taglibs/optimizer/EnableExtensionTag/">EnableExtensionTag</a> </li><li id="nav_raptor_templating_taglibs_optimizer_ImgTag" class="raptor-module"><a href="./raptor/templating/taglibs/optimizer/ImgTag/">ImgTag</a> </li><li id="nav_raptor_templating_taglibs_optimizer_PageTag" class="raptor-module"><a href="./raptor/templating/taglibs/optimizer/PageTag/">PageTag</a> </li><li id="nav_raptor_templating_taglibs_optimizer_PageTagTransformer" class="raptor-module"><a href="./raptor/templating/taglibs/optimizer/PageTagTransformer/">PageTagTransformer</a> </li><li id="nav_raptor_templating_taglibs_optimizer_SlotTag" class="raptor-module"><a href="./raptor/templating/taglibs/optimizer/SlotTag/">SlotTag</a> </li></ul> </li><li id="nav_raptor_templating_taglibs_widgets" class="folder"><a href="#">widgets</a><ul><li id="nav_raptor_templating_taglibs_widgets_compile-time-package_json" class="package"><a href="./source/raptor/templating/taglibs/widgets/compile-time-package.json/">compile-time-package.json</a> </li><li id="nav_raptor_templating_taglibs_widgets_package_json" class="package"><a href="./source/raptor/templating/taglibs/widgets/package.json/">package.json</a> </li><li id="nav_raptor_templating_taglibs_widgets_WidgetFunctions" class="raptor-module"><a href="./raptor/templating/taglibs/widgets/WidgetFunctions/">WidgetFunctions</a> </li><li id="nav_raptor_templating_taglibs_widgets_InitWidgetsTag" class="raptor-class"><a href="./raptor/templating/taglibs/widgets/InitWidgetsTag/">InitWidgetsTag</a> </li><li id="nav_raptor_templating_taglibs_widgets_WidgetsTagTransformer" class="raptor-class"><a href="./raptor/templating/taglibs/widgets/WidgetsTagTransformer/">WidgetsTagTransformer</a> </li><li id="nav_raptor_templating_taglibs_widgets_WidgetTag" class="raptor-class"><a href="./raptor/templating/taglibs/widgets/WidgetTag/">WidgetTag</a> </li></ul> </li></ul> </li></ul> </li><li id="nav_raptor_widgets" class="raptor-module"><a href="./raptor/widgets/">widgets</a><ul><li id="nav_raptor_widgets_package_json" class="package"><a href="./source/raptor/widgets/package.json/">package.json</a> </li><li id="nav_raptor_widgets_Browser" class="object extension"><a href="./raptor/widgets_Browser/">Browser Extension</a> </li><li id="nav_raptor_widgets_Server" class="object extension"><a href="./raptor/widgets_Server/">Server Extension</a> </li><li id="nav_raptor_widgets_Widget" class="raptor-class"><a href="./raptor/widgets/Widget/">Widget</a><ul><li id="nav_raptor_widgets_Widget_jQuery" class="object extension"><a href="./raptor/widgets/Widget_jQuery/">jQuery Extension</a> </li><li id="nav_raptor_widgets_Widget_Legacy" class="object extension"><a href="./raptor/widgets/Widget_Legacy/">Legacy Extension</a> </li></ul> </li><li id="nav_raptor_widgets_WidgetDef" class="raptor-class"><a href="./raptor/widgets/WidgetDef/">WidgetDef</a> </li><li id="nav_raptor_widgets_WidgetsContext" class="raptor-class"><a href="./raptor/widgets/WidgetsContext/">WidgetsContext</a> </li></ul> </li><li id="nav_raptor_xml" class="folder"><a href="#">xml</a><ul><li id="nav_raptor_xml_dom" class="raptor-module"><a href="./raptor/xml/dom/">dom</a><ul><li id="nav_raptor_xml_dom_package_json" class="package"><a href="./source/raptor/xml/dom/package.json/">package.json</a> </li><li id="nav_raptor_xml_dom_DomParser_jQuery" class="raptor-class"><a href="./raptor/xml/dom/DomParser_jQuery/">DomParser (jQuery Extension)</a> </li></ul> </li><li id="nav_raptor_xml_dom-to-sax" class="raptor-module"><a href="./raptor/xml/dom-to-sax/">dom-to-sax</a><ul><li id="nav_raptor_xml_dom-to-sax_package_json" class="package"><a href="./source/raptor/xml/dom-to-sax/package.json/">package.json</a> </li><li id="nav_raptor_xml_dom-to-sax_Attribute" class="class"><a href="./raptor/xml/dom-to-sax/Attribute/">Attribute</a> </li><li id="nav_raptor_xml_dom-to-sax_Element" class="class"><a href="./raptor/xml/dom-to-sax/Element/">Element</a> </li></ul> </li><li id="nav_raptor_xml_sax" class="raptor-module"><a href="./raptor/xml/sax/">sax</a><ul><li id="nav_raptor_xml_sax_package_json" class="package"><a href="./source/raptor/xml/sax/package.json/">package.json</a> </li><li id="nav_raptor_xml_sax_object-mapper" class="raptor-module"><a href="./raptor/xml/sax/object-mapper/">object-mapper</a><ul><li id="nav_raptor_xml_sax_object-mapper_package_json" class="package"><a href="./source/raptor/xml/sax/object-mapper/package.json/">package.json</a> </li><li id="nav_raptor_xml_sax_object-mapper_Reader" class="class"><a href="./raptor/xml/sax/object-mapper/Reader/">Reader</a> </li></ul> </li><li id="nav_raptor_xml_sax_BaseSaxParser" class="raptor-class"><a href="./raptor/xml/sax/BaseSaxParser/">BaseSaxParser</a> </li><li id="nav_raptor_xml_sax_SaxParserDom" class="raptor-class"><a href="./raptor/xml/sax/SaxParserDom/">SaxParserDom</a> </li></ul> </li><li id="nav_raptor_xml_utils" class="raptor-module"><a href="./raptor/xml/utils/">utils</a><ul><li id="nav_raptor_xml_utils_package_json" class="package"><a href="./source/raptor/xml/utils/package.json/">package.json</a> </li><li id="nav_raptor_xml_utils_" class="object extension"><a href="./raptor/xml/utils_/">null Extension</a> </li></ul> </li><li id="nav_raptor_xml_Attribute" class="raptor-class"><a href="./raptor/xml/Attribute/">Attribute</a> </li><li id="nav_raptor_xml_Element" class="raptor-class"><a href="./raptor/xml/Element/">Element</a> </li><li id="nav_raptor_xml_SaxParser_Node" class="raptor-class"><a href="./raptor/xml/SaxParser_Node/">SaxParser (Node Extension)</a><ul><li id="nav_raptor_xml_SaxParser_Node_Attribute" class="class"><a href="./raptor/xml/SaxParser_Node/Attribute/">Attribute (Node Extension)</a> </li><li id="nav_raptor_xml_SaxParser_Node_Element" class="class"><a href="./raptor/xml/SaxParser_Node/Element/">Element (Node Extension)</a> </li></ul> </li><li id="nav_raptor_xml_SaxParser_Rhino" class="raptor-class"><a href="./raptor/xml/SaxParser_Rhino/">SaxParser (Rhino Extension)</a><ul><li id="nav_raptor_xml_SaxParser_Rhino_Attribute" class="class"><a href="./raptor/xml/SaxParser_Rhino/Attribute/">Attribute (Rhino Extension)</a> </li><li id="nav_raptor_xml_SaxParser_Rhino_Element" class="class"><a href="./raptor/xml/SaxParser_Rhino/Element/">Element (Rhino Extension)</a> </li></ul> </li></ul> </li><li id="nav_raptor_configConfig" class="class"><a href="./raptor/configConfig/">configConfig</a> </li><li id="nav_raptor_loaderTransaction" class="object"><a href="./raptor/loaderTransaction/">loaderTransaction</a> </li></ul> </li><li id="nav_raptor-legacy" class="folder"><a href="#">raptor-legacy</a><ul><li id="nav_raptor-legacy_package_json" class="package"><a href="./source/raptor-legacy/package.json/">package.json</a> </li></ul> </li><li id="nav_JSON" class="object"><a href="./JSON/">JSON</a> </li><li id="nav_global" class="global"><a href="./global/">Global</a> </li></ul></div></div></div><div id="main"><div class="header"><h1><a href="./"><span class="title">RaptorJS API Docs</span></a><span class="version">2.6.16</span><div class="powered-by">Powered by <a href="http://raptorjs.org/">RaptorJS</a></div></h1></div><div id="mainContent"><h1>/raptor/optimizer/PageOptimizer.js</h1><pre class="code sh_javascript_dom">var util = require('util');

var util = require('util');

var util = require('util');
var nodePath = require('path');
var q = require('q');

function getResourceUrlCacheKey(path, baseResource) {
    var key = path;
    if (baseResource) {
        key += '|' + baseResource.getURL();
    }
    return key;
}

define.Class(
    'raptor/optimizer/PageOptimizer',
    ['raptor'],
    function(raptor, require, exports, module) {
        "use strict";
        
        var packaging = require('raptor/packaging');
        var Cache = require('raptor/optimizer/Cache');
        var OptimizerWriterMixins = require('raptor/optimizer/OptimizerWriterMixins');
        var OptimizerFileWriter = require('raptor/optimizer/OptimizerFileWriter');
        var FileUrlBuilder = require('raptor/optimizer/FileUrlBuilder');
        var OptimizedPage = require('raptor/optimizer/OptimizedPage');
        var SlotTracker = require('raptor/optimizer/SlotTracker');
        var File = require('raptor/files/File');
        var promises = require('raptor/promises');
        var escapeXmlAttr = require('raptor/xml/utils').escapeXmlAttr;
        var logger = module.logger();
        var crypto = require('crypto');
        var forEach = raptor.forEach;
        var resources = require('raptor/resources');
        var mime = require('raptor/mime');

        /*
         * Bundle wrappers are objects that describe code prefixes and suffixes that
         * will be written for a bundle when enabled. In in-place-deployment mode,
         * a bundle for a source file might not be written so these wrappers will have
         * no impact on those files.
         */
        var DEFAULT_BUNDLE_WRAPPERS = [
            {
                /*
                 * This wrapper puts all bundle code in the scope of a function that is provided
                 * a define function, require function, and "raptorNoConflict" flag. This allows
                 * the raptor module to not to have to put define and require functions in the global
                 * scope which might conflict with other AMD-like implementations (such as RequireJS).
                 */
                id: 'raptor-no-conflict',
                prefix: '(function(define, require, raptorNoConflict) {\n',
                suffix: '\n})(window.raptorDefine, window.raptorRequire, true);',
                contentType: 'application/javascript'
            }
        ];
        // This function is moved outside the optimagePageCached method to avoid memory
        // leak from closures
        
        function evictOptimizedPageFromCache(cache, cacheKey, ttl) {
            logger.info('Scheduling cached object with key "' + cacheKey + '" to be evicted' + ttl + 'ms');
            
            setTimeout(function() {
                logger.info('Evicting cached object with key "' + cacheKey + '". TTL configured to be ' + ttl + 'ms');
                cache.removeOptimizedPage(cacheKey);
            }, ttl);
        }

        var PageOptimizer = function(config) {
            if (!config) {
                throw new Error('config is required');
            }

            this.config = config;
            this.cacheLookup = {};
            this.cacheProvider = config.cacheProvider || require('raptor/caching').getDefaultProvider();

            this.config.notifyPlugins('pageOptimizerConfigured', {
                config: this.config,
                pageOptimizer: this
            });

            // Look for bundle wrappers from the config object or use the defaults.
            // NOTE: Bundle wrappers have to be explicitly enabled (they're disabled by default).
            //       Bundle wrappers can be enabled in the PageOptimizer Config or BundleConfig.
            var bundleWrappers;
            if (config.wrappers === undefined) {
                bundleWrappers = DEFAULT_BUNDLE_WRAPPERS;
            }

            if (bundleWrappers) {
                // create copy of input bundle wrappers array
                this.bundleWrappers = bundleWrappers.slice();
            }
        };
        
        PageOptimizer.prototype = {
            

            getPageBundleSetConfig: function(pageName) {
                
                var pageConfig = this.config.getPageConfig(pageName),
                    bundleSetConfig = null;
                
                if (pageConfig) {
                    bundleSetConfig = pageConfig.bundleSetConfig;
                }
                
                if (!bundleSetConfig) {
                    bundleSetConfig = this.config.getBundleSetConfig("default");
                    
                    if (!bundleSetConfig) {
                        bundleSetConfig = this.config.addBundleSetConfig({
                            name: "default"
                        });
                    }
                }
                
                return bundleSetConfig;
            },
            
            /**
             * This enables localization which triggers special bundle and module creation for enabled locales
             *
             * @param context the optimization context (whose i18n property will be initialized to a new I18nContext)
             * @param bundleSetConfig the bundle set configuration that is in use which will have new i18n
             *  bundle configurations added to it
             */
            enableLocalization: function(context, bundleSetConfig) {
                // create the i18n context and configure the bundles for each locale
                context.i18n = require('raptor/optimizer/i18n').createContext({
                    locales: this.config.getLocales()
                });
            },

            buildPageBundles: function(options, context) {

                var PageBundles = require('raptor/optimizer/PageBundles'),
                    pageName = options.name || options.pageName,
                    config = this.config,
                    enabledExtensions = packaging.createExtensionCollection(options.enabledExtensions),
                    _this = this;
                
                if (!pageName) {
                    throw raptor.createError(new Error('"name" property is required'));
                }
                
                /*
                 * If there are any globally enabled extensions then add those
                 */
                enabledExtensions.addAll(this.config.getEnabledExtensions());
                context.enabledExtensions = enabledExtensions;
                
                var bundleSetConfig = this.getPageBundleSetConfig(pageName);

                if (this.config.enabledLocales) {
                    this.enableLocalization(context, bundleSetConfig);
                }
                
                var packageManifest = options.packageManifest;
                
                if (!packageManifest) {
                    var packageResource = options.packageResource;
                    if (packageResource) {
                        packageManifest = packaging.getPackageManifest(packageResource);
                    }
                    else {
                        var packageFile = options.packageFile;
                        if (packageFile) {
                            if (typeof packageFile === 'string') {
                                var packageFilePath = packageFile;
                                packageFile = new File(packageFilePath);
                                if (!packageFile.exists()) {
                                    throw raptor.createError(new Error("Provided package file does not exist: " + packageFilePath));
                                }
                            }
                            
                            packageResource = require('raptor/resources').createFileResource(packageFile);
                            packageManifest = packaging.getPackageManifest(packageResource);
                        }
                        else {
                            var dependencies = options.dependencies;
                            if (dependencies) {
                                packageManifest = packaging.createPackageManifest();
                                packageManifest.setDependencies(dependencies);
                            }
                            else {
                                module = options.module;
                                if (module) {
                                    packageManifest = require('raptor/packaging').getModuleManifest(module);
                                }
                            }
                        }
                    }
                }
                else if (!packaging.isPackageManifest(packageManifest)) {
                    throw raptor.createError(new Error("Invalid package manifest: " + packageManifest));
                }
                
                if (!packageManifest) {
                    throw raptor.createError(new Error("Package manifest for page not provided. One of the following properties is required:  packageManifest, packageResource, packageFile, dependencies, module"));
                }

                var sourceUrlResolver = config.hasServerSourceMappings() ? function(path) {
                    return config.getUrlForSourceFile(path);
                } : null;
                
                var startTime = Date.now();
                var bundleMappingsPromise = config.isBundlingEnabled() ?
                        this.getBundleMappingsCached(bundleSetConfig, context) : //Only load the bundle mappings if bundling is enabled
                        null;

                function buildPageBundles(bundleMappings) {

                    var startTime = Date.now();
                    var pageBundles = new PageBundles({
                        pageName: pageName,
                        bundleMappings: bundleMappings,
                        bundlingEnabled: config.isBundlingEnabled(),
                        inPlaceDeploymentEnabled: config.isInPlaceDeploymentEnabled(),
                        sourceUrlResolver: sourceUrlResolver,
                        enabledExtensions: enabledExtensions,
                        packageManifest: packageManifest,
                        checksumsEnabled: config.isChecksumsEnabled(),
                        context: context
                    });

                    var pageBundlesPromise = pageBundles.build();
                    pageBundlesPromise.then(function() {
                        logger.info('Page bundles for "' + pageName + '" built in ' + (Date.now() - startTime) + 'ms');
                    });
                    return pageBundlesPromise;
                }


                if (bundleMappingsPromise) {
                    bundleMappingsPromise.then(
                        function() {
                            logger.info('Bundle mappings for page "' + pageName + '" built in ' + (Date.now() - startTime) + 'ms');
                        });

                    return bundleMappingsPromise.then(buildPageBundles);
                }
                else {
                    return buildPageBundles(null);
                }
            },
            
            getBundleMappingsCached: function(bundleSetConfig, context) {
                var cache = this.getCache(context);
                var cacheKey = bundleSetConfig._id;

                var bundleMappingsPromise = cache.getBundleMappings(cacheKey);
                if (!bundleMappingsPromise) {
                    
                    bundleMappingsPromise = this.config.createBundleMappings(bundleSetConfig, context);
                    
                    cache.addBundleMappings(bundleSetConfig._id, bundleMappingsPromise);
                }
                return bundleMappingsPromise;
            },

            uncacheBundleMappings: function(bundleSetConfig, context) {
                var cache = this.getCache(context);
                var cacheKey = bundleSetConfig._id;
                cache.removeBundleMappings(bundleSetConfig._id);
            },

            buildCacheKey: function(context) {

                var config = this.getConfig();
                
                var cacheKey = null;

                function cacheKey_add(str) {
                    if (cacheKey) {
                        cacheKey += '|' + str;
                    }
                    else {
                        cacheKey = str;
                    }
                }

                config.notifyPlugins('buildCacheKey', {
                    context: context,
                    config: config,
                    pageOptimizer: this,
                    cacheKey: {
                        add: cacheKey_add
                    }
                });

                var enabledExtensions = context.enabledExtensions;
                if (enabledExtensions) {
                    cacheKey_add(enabledExtensions.getKey());
                }
                
                return cacheKey || '';
            },

            getCache: function(context) {
                var key = this.buildCacheKey(context);
                return this.cacheLookup[key] || (this.cacheLookup[key] = new Cache(this.cacheProvider, context, key));
            },

            clearCache: function() {
                raptor.forEachEntry(this.cacheLookup, function(key, cache) {
                    cache.clear();
                });
            },

            clearBundleMappingsCache: function() {
                raptor.forEachEntry(this.cacheLookup, function(key, cache) {
                    logger.info("Removing bundle mappings for cache " + key);
                    cache.removeAllBundleMappings();
                });
            },
            
            getConfig: function() {
                return this.config;
            },

            getWriter: function() {
                return this.writer || this.createWriter();
            },

            createWriter: function(context) {
                var Writer = this.config.getWriter();

                if (Writer) {
                    if (typeof Writer === 'string') {
                        Writer = require(Writer);
                    }
                    else if (typeof Writer !== 'function') {
                        return Writer;
                    }
                }
                else {
                    Writer = OptimizerFileWriter;
                }

                var writer = new Writer(this);
                this.writer = writer;
                return writer;
            },

            applyFilters: function(code, contentType, context) {

                var deferred = promises.defer();

                var filters = this.getConfig().getFilters();


                if (!filters || filters.length === 0) {
                    deferred.resolve(code);
                    return deferred.promise;
                }

                var promiseChain = null;
                var errorHandled = false;
                function onError(e) {
                    if (errorHandled) {
                        return;
                    }

                    errorHandled = true;
                    deferred.reject(e);
                }

                forEach(filters, function(filterFunc) {
                    if (filterFunc.contentType &amp;&amp; filterFunc.contentType !== contentType) {
                        return;
                    }
                    
                    function applyFilter(code) {
                        try
                        {
                            var startTime = Date.now();

                            var output = filterFunc(code, contentType, context);
                            if (output == null) {
                                output = code;
                            }

                            var finishTime = function(code) {
                                var elapsedTime = Date.now() - startTime;
                                if (elapsedTime > 1000) {
                                    logger.debug('Filter (' + filterFunc._name + ') completed in ' + (elapsedTime) + 'ms. Code:\n' + code);
                                }
                            };

                            if (promises.isPromise(output)) {
                                output.then(finishTime);
                            }
                            else {
                                finishTime();
                                var deferred = promises.defer();
                                deferred.resolve(output);
                                output = deferred.promise;
                            }

                            return output;
                        }
                        catch(e) {
                            onError(e);
                        }
                    }

                    if (promiseChain) {
                        promiseChain = promiseChain.then(
                            applyFilter,
                            onError);

                    }
                    else {
                        promiseChain = applyFilter(code);
                    }
                }, this);

                if (!promiseChain) {
                    deferred.resolve(code);
                    return deferred.promise;
                }
                else {
                    promiseChain.then(
                        function(code) {
                            deferred.resolve(code);
                        },
                        onError);

                    promiseChain.fail(onError);
                }

                

                return deferred.promise;
            },
            
            getJavaScriptDependencyHtml: function(url) {
                return '&lt;script type="text/javascript" src="' + escapeXmlAttr(url) + '">&lt;/script>';
            },

            getCSSDependencyHtml: function(url) {
                return '&lt;link rel="stylesheet" type="text/css" href="' + escapeXmlAttr(url) + '">';
            },

            calculateChecksum: function(code, restrictLength) {
                var shasum = crypto.createHash('sha1');
                shasum.update(code);
                var checksum = shasum.digest('hex'),
                    checksumLength = this.config.getChecksumLength();
                
                if (restrictLength !== false &amp;&amp; checksumLength > 0 &amp;&amp; checksum.length > checksumLength) {
                    checksum = checksum.substring(0, checksumLength);
                }
                
                return checksum;
            },

            readDependency: function(dependency, context) {

                var deferred = promises.defer();

                function onError(e) {
                    deferred.reject(e);
                }

                var contentType = dependency.getContentType();

                var filterContext = context ? raptor.extend({}, context) : {};
                filterContext.contentType = contentType;
                filterContext.dependency = dependency;
                var _this = this;


                function applyFilters(code) {
                    var promise = _this.applyFilters(code, contentType, filterContext);
                    promise.then(
                        function(code) {
                            deferred.resolve(code);
                        },
                        onError);
                }

                try {
                    var code = dependency.getCode(context);
                    if (promises.isPromise(code)) {
                        var codePromise = code;
                        codePromise.then(applyFilters, onError);
                    }
                    else {
                        applyFilters(code);
                    }
                } catch(e) {
                    logger.error('Error getting code for dependency ' + dependency, e);
                    onError(e);
                }

                return deferred.promise;
            },

            readBundle: function(bundle, context, options) {
                var startTime = Date.now();
                options = options || {};
                var includeDependencies = options.includeDependencies === true;

                logger.debug("Reading bundle: " + bundle.getKey());
                var dependencies = bundle.getDependencies();

                var deferred = promises.defer();
                var contentType = bundle.getContentType();
                var _this = this;

                var outputPromise = deferred.promise;

                var checksumsEnabled = options.includeChecksums === true || bundle.checksumsEnabled;
                if (checksumsEnabled === undefined) {
                    // checksumsEnabled not set for bundle so check optimizer config
                    checksumsEnabled = (this.config.checksumsEnabled !== false) || bundle.requireChecksum;
                }

                checksumsEnabled = checksumsEnabled === true;

                var errorHandled = false;

                function onError(e) {
                    if (errorHandled) {
                        return;
                    }
                    errorHandled = true;

                    logger.error('Unable to read bundle ' + bundle.getKey() + '. Exception: ' + (e.stack || e));
                    deferred.reject(e);
                }
                
                

                // Step 1
                function filterCode() {
                    
                    var filteredCodeArray = new Array(dependencies.length);
                    var pending = dependencies.length;
                    var filterCodeDeferred = promises.defer();

                    var errorHandled = false;

                    function filterCodeOnError(e) {
                        if (errorHandled) {
                            return;
                        }
                        errorHandled = true;

                        filterCodeDeferred.reject(e);
                    }


                    dependencies.forEach(function(dependency, i) {
                        // Each filter needs its own context since we update the context with the
                        // current dependency and each dependency is filtered in parallel
                        var filterContext = context ? raptor.extend({}, context) : {};
                        filterContext.bundle = bundle;
                        filterContext.contentType = contentType;
                        filterContext.dependency = dependency;
                        var code = dependency.getCode(context);

                        function applyFilters(code) {
                            var promise = _this.applyFilters(code, contentType, filterContext);
                            promise
                                .then(function(code) {
                                    filteredCodeArray[i] = code;

                                    if (--pending === 0) {
                                        filterCodeDeferred.resolve(filteredCodeArray);
                                    }
                                })
                                .fail(filterCodeOnError);
                        }

                        if (promises.isPromise(code)) {
                            var codePromise = code;
                            codePromise
                                .then(applyFilters)
                                .fail(filterCodeOnError);
                        }
                        else {
                            applyFilters(code);
                        }

                        
                    });

                    return filterCodeDeferred.promise;
                }


                // Step 2
                function finish(filteredCodeArray) {
                    var bundleCode = filteredCodeArray.join("\n");
                    var bundleChecksum = checksumsEnabled ? _this.calculateChecksum(bundleCode) : null;

                    logger.info('Bundle ' + bundle.getKey() + ' read in ' + (Date.now() - startTime) + 'ms');

                    var dependencyInfoArray;

                    if (includeDependencies) {
                        dependencyInfoArray = new Array(dependencies.length);

                        filteredCodeArray.forEach(function(filteredCode, i) {
                            var dependencyChecksum = checksumsEnabled ? _this.calculateChecksum(filteredCode) : null;
                            dependencyInfoArray[i] = {
                                code: filteredCode,
                                checksum: dependencyChecksum,
                                dependency: dependencies[i]
                            };
                        });
                    }
                        

                    deferred.resolve({
                        code: bundleCode,
                        checksum: bundleChecksum,
                        dependencies: dependencyInfoArray
                    });
                }

                try {
                    filterCode()
                        .then(finish)
                        .fail(onError);
                }
                catch(e) {
                    onError(e);
                }
                
                return deferred.promise;
            },

            optimizePageCached: function(context, cacheKey, options) {
                
                if (!context) {
                    context = {};
                }

                var cache = this.getCache(context);
                var optimizedPage = cache.getOptimizedPage(cacheKey);
                var _this = this;
                var rebuildCacheTimeout = -1;
                var cacheTTL = -1;

                function handleRebuildCacheTimeout() {
                    if (rebuildCacheTimeout !== -1) {

                        logger.debug('Scheduling optimized page to be rebuilt in ' + rebuildCacheTimeout + 'ms');

                        setTimeout(function () {
                            logger.debug('Rebuilding optimizer cache...');
                            try
                            {
                                _this.optimizePage(options)
                                    .then(
                                        cacheOptimizedPage,
                                        handleRebuildCacheTimeout);
                            }
                            catch(e) {
                                logger.error("Error in handleRebuildCacheTimeout: ", e);
                            }
                        }, rebuildCacheTimeout);

                        rebuildCacheTimeout = -1;
                    }
                }

                function handleCacheTimeToLive() {
                    if (cacheTTL !== -1) {
                        evictOptimizedPageFromCache(cache, cacheKey, cacheTTL);
                        cacheTTL = -1;
                    }
                }

                function cacheOptimizedPage(optimizedPage) {
                    handleRebuildCacheTimeout();
                    handleCacheTimeToLive();
                }


                if (!optimizedPage) {
                    if (typeof options === 'function') {
                        options = options();
                    }

                    context.setRebuildCacheTimeout = function(newCacheTimeout) {
                        rebuildCacheTimeout = newCacheTimeout;
                    };

                    context.setCacheTimeToLive = function(newTTL) {
                        cacheTTL = newTTL;
                    };

                    context.isOptimizedPageCached = function() {
                        var cachedOptimizedPage = cache.getOptimizedPage(cacheKey);
                        return cachedOptimizedPage &amp;&amp; !promises.isPromise(cachedOptimizedPage);
                    };

                    var optimizedPagePromise = this.optimizePage(options);

                    optimizedPage = optimizedPagePromise;
                    
                    cache.addOptimizedPage(cacheKey, optimizedPagePromise);

                    optimizedPagePromise
                        .then(cacheOptimizedPage)
                        .fail(function() {
                            // Remove the failed promise so that we can try again next time
                            cache.removeOptimizedPage(cacheKey);
                        });
                }

                return optimizedPage;
            },
            
            optimizePage: function(options) {
                var startTime = new Date().getTime();
                var deferred = promises.defer(); // This will be used to generate the returned promise

                // if we create a new context then make sure we put it
                // back into the options object for reference later
                var context = options.context || (options.context = {});
                var config = this.getConfig();

                if (options.basePath) {
                    context.basePath = options.basePath;
                }

                var pluginContext = {
                    context: context,
                    config: config,
                    options: options,
                    pageOptimizer: this
                };

                config.notifyPlugins('beforeOptimizePage', pluginContext);


                var writer = options.writer || this.getWriter();
                writer.config = config;
                OptimizerWriterMixins.addMixins(writer);
                writer.setPageOptimizer(this);
                writer.setConfig(config);

                var optimizedPage = new OptimizedPage();
                
                var slotTracker = new SlotTracker();
                var _this = this;

                context.config = config;
                context.writer = writer;
                context.optimizer = this;

                if (!context.attributes) {
                    context.attributes = {};
                }

                var errorHandled = false;

                function onError(e) {
                    if (errorHandled) {
                        return;
                    }
                    errorHandled = true;
                    
                    deferred.reject(e);
                }


                if (config.bundleWrappers) {
                    logger.info('Enabled bundle wrappers: ' + Object.keys(config.bundleWrappers).join(', ') + ' (these can be overridden at the bundle level)');
                } else {
                    logger.info('No bundle wrappers enabled (this can be overridden at the bundle level)');
                }

                function buildLoaderMetadata(pageBundles) {
                    var loaderMetadata = {};

                    if (pageBundles.hasAsyncRequires()) {
                        pageBundles.forEachAsyncRequire(function(asyncRequire) {
                            var entry = loaderMetadata[asyncRequire.getName()] = {
                                requires: [],
                                css: [],
                                js: []
                            };
                            
                            forEach(asyncRequire.getRequires(), function(require) {
                                entry.requires.push(require);
                            });
                            
                            forEach(asyncRequire.getBundles(), function(bundle) {
                                if (bundle.isJavaScript()) {
                                    entry.js.push(bundle.getUrl(context));
                                }
                                else if (bundle.isStyleSheet()) {
                                    entry.css.push(bundle.getUrl(context));
                                }
                                else {
                                    throw raptor.createError(new Error("Invalid bundle content type: " + bundle.getContentType()));
                                }
                            });
                            
                            if (!entry.requires.length) {
                                delete entry.requires;
                            }
                            
                            if (!entry.js.length) {
                                delete entry.js;
                            }
                            
                            if (!entry.css.length) {
                                delete entry.css;
                            }
                        });
                    }

                    context.loaderMetadata = loaderMetadata;
                    optimizedPage.setLoaderMetadata(loaderMetadata);
                }

                function registerBundle(bundle, async) {
                    if (!async) {
                        optimizedPage.addUrl(bundle.getUrl(context), bundle.getSlot(), bundle.getContentType());
                        
                        if (bundle.outputFile) {
                            optimizedPage.addFile(bundle.outputFile, bundle.getContentType());
                        }
                        else if (bundle.sourceResource) {
                            if (bundle.sourceResource.isFileResource()) {
                                optimizedPage.addFile(bundle.sourceResource.getFilePath(), bundle.getContentType());
                            }
                        }
                    }
                    else {
                        // TODO: Should we track URLs and files for async-only bundles?
                    }

                }

                function onBundleWritten(bundle) {
                    registerBundle(bundle, false);
                }

                function onAsyncBundleWritten(bundle) {
                    registerBundle(bundle, true);
                }

                function buildHtmlSlots(pageBundles) {
                    pageBundles.forEachBundle(function(bundle) {
                        var html,
                            url;
                        
                        if (bundle.isInline() &amp;&amp; !bundle.inPlaceDeployment) {
                            if (bundle.isMergeInline()) {
                                slotTracker.addContent(bundle.getSlot(), bundle.getContentType(), bundle.getCode(), true /* inline */);
                            }
                            else {
                                slotTracker.addContentBlock(bundle.getSlot(), bundle.getContentType(), bundle.getCode());
                            }
                        }
                        else {
                            url = bundle.getUrl(context);

                            if (bundle.isJavaScript()) {
                                html = _this.getJavaScriptDependencyHtml(url);
                            }
                            else if (bundle.isStyleSheet()) {
                                html = _this.getCSSDependencyHtml(url);
                            }
                            else {
                                throw raptor.createError(new Error("Invalid bundle content type: " + bundle.getContentType()));
                            }
                            slotTracker.addContent(bundle.getSlot(), bundle.getContentType(), html, (!bundle.inPlaceDeployment &amp;&amp; bundle.isInline()));
                        }
                    });

                    optimizedPage.setHtmlBySlot(slotTracker.getHtmlBySlot());
                }

                
                var pageBundlesPromise = this.buildPageBundles(options, context);

                pageBundlesPromise
                    .then(
                        function(pageBundles) {

                            // First write out all of the async bundles
                            writer.writeBundles(pageBundles.forEachAsyncBundleIter(), onAsyncBundleWritten, context)
                                .then(
                                    function() {
                                        try {
                                            // Now that we have build the async bundles we can build the
                                            // loader metadata so that it can be added to page bundles
                                            buildLoaderMetadata(pageBundles);

                                            // Now write out all of the non-async bundles
                                            return writer.writeBundles(pageBundles.forEachBundleIter(), onBundleWritten, context);
                                        }
                                        catch(e) {
                                            onError(e);
                                        }
                                        
                                    })
                                .then(
                                    function() {

                                        // All of the bundles have now been persisted, now we can
                                        // generate all of the HTML for the page
                                        buildHtmlSlots(pageBundles);


                                        var pageName = options.name || options.pageName;
                                        logger.info('Optimized page "' + pageName + '" in ' + (Date.now() - startTime) + 'ms');

                                        //All done! Resolve the promise with the optimized page
                                        deferred.resolve(optimizedPage);
                                    })
                                .fail(onError);
                        })
                    .fail(onError);
                
                return deferred.promise;
            },

            getBundleWrappers: function() {
                return this.bundleWrappers;
            },

            isWrapperEnabledForBundle: function(wrapper, bundle) {
                var wrapperId = wrapper.id;

                if (wrapper.contentType !== bundle.getContentType()) {
                    logger.debug('Bundle wrapper "' + wrapperId + '" with contentType "' + wrapper.contentType + '" does not match bundle content type of "' + bundle.getContentType() + '"');
                    return false;
                }

                // are there any wrappers explicitly configured for the bundle?
                var enabledWrappers = bundle.getWrappers();
                if (bundle.wrappers === undefined) {
                    // no wrappers set at the bundle level so check for which wrappers have been "globally" enabled
                    enabledWrappers = this.config.bundleWrappers;
                }

                return (enabledWrappers &amp;&amp; (enabledWrappers[wrapperId] === true));
            },

            resolveResourceUrlCached: function(path, baseResource, context) {
                var cache = this.getCache(context);
                var cacheKey = getResourceUrlCacheKey(path, baseResource);
                var resourceUrl = cache.getResourceUrl(cacheKey);
                if (resourceUrl) {
                    return resourceUrl;
                }

                resourceUrl = this.resolveResourceUrl(path, baseResource, context);
                cache.addResourceUrl(cacheKey, resourceUrl);

                resourceUrl
                    .fail(function() {
                        // Remove the cached resource URL if the promise
                        // is rejected in order to give the system
                        // a chance to recover
                        cache.removeResourceUrl(cacheKey);
                    });

                return resourceUrl;
            },

            /**
             * Supported properties for the context argument:
             * &lt;ul>
             *     &lt;li>inPlaceFromDir: Directory for calculating relative paths for in-place deployment (if enabled, optional)
             *     &lt;li>relativeFromDir: Directory for calculating relative path for final URL (optional)
             * &lt;/ul>
             * 
             * @param  {String} path The resource path to resolve to a URL
             * @param  {raptor/resources/Resource} baseResource The base resource (required for relative resource paths)
             * @param  {Object} context Additional contextual information
             * @return {Promise} The promise that will eventually resolve to the URL
             */
            resolveResourceUrl: function(path, baseResource, context) {
                if (path.startsWith("http://") ||
                    path.startsWith("https://") ||
                    path.startsWith("//")) {
                    return path;
                }

                context = context || {};

                var inPlaceFromDir = context.inPlaceFromDir;
                var relativeFromDir = context.relativeFromDir;

                var writer = this.getWriter();

                var config = this.getConfig();

                var inputPath = path;

                var hashString = '',
                    hashStart = path.indexOf('#');

                if (hashStart != -1) {
                    hashString = path.substring(hashStart);
                    path = path.substring(0, hashStart);
                }

                var queryString = '',
                    queryStart = path.indexOf('?');

                if (queryStart != -1) {
                    queryString = path.substring(queryStart);
                    path = path.substring(0, queryStart);
                }

                var resource = resources.resolveResource(baseResource, path);
                if (resource &amp;&amp; resource.isFileResource() &amp;&amp; resource.exists()) {
                    if (inPlaceFromDir &amp;&amp; config.isInPlaceDeploymentEnabled()) {
                        // This code block is for in-place deployment, but the CSS resource needs to be
                        // compiled (such as LESS). While we can't do in-place deployment for the 
                        // LESS file (since it needs to be compiled), we can at least rewrite the 
                        // image URLs to point to the original location. Therefore, we need to modify
                        // the relative path based on the fact that the final CSS file will be
                        // in a new directory.
                        
                        path = writer.urlBuilder.getInPlaceResourceUrl(
                            resource.getFilePath(), 
                            inPlaceFromDir);

                        if (path) {
                            path += queryString + hashString;
                            logger.debug("Resolved URL: " + inputPath + ' --> ' + path);
                            return q(path);
                        }
                        
                    }

                    var base64Encode = queryString === '?base64';

                    if (base64Encode &amp;&amp; writer.base64EncodeSupported !== true) {
                        // We only do the Base64 encoding if the writer prefers not
                        // to do the Base64 encoding or does not support Base64 encoding
                        path = 'data:' + mime.lookup(resource.getPath()) + ';base64,' + resource.readAsBinary().toString('base64');
                        return q(path);
                    }
                    else {
                        context = raptor.extend({}, context);
                        // Record that base 64 encoding was requested for this resource (this might be helpful to the writer)
                        context.base64EncodeUrl = base64Encode;

                        return writer.writeResource(resource, context)
                            .then(function(outputFileInfo) {
                                if (relativeFromDir &amp;&amp; outputFileInfo.file) {
                                    // The resource was written to disk, we can calculate
                                    // a relative path from the optimizer output directory (where this CSS file will reside)
                                    // to the output image/resource
                                    path = nodePath.relative(
                                        relativeFromDir, 
                                        outputFileInfo.file.getAbsolutePath()) + queryString + hashString;
                                }
                                else if (outputFileInfo.url) {
                                    path = outputFileInfo.url;

                                    if (path.startsWith("data:") === false) {
                                        path = path + queryString + hashString;    
                                    }
                                }
                                else {
                                    throw new Error('Invalid output from "writer.writeResource": ' + require('util').inspect(outputFileInfo));
                                }

                                logger.debug("Resolved URL: ", inputPath, ' --> ', path);
                                return path;
                            });
                    }
                    
                }

                path = inputPath;
                
                logger.debug("Resolved URL: ", inputPath, ' --> ', path);

                return q(path);
            }
        };
        
        return PageOptimizer;
    });
</pre> </div></div><div id="footer"><div class="fineprint" style="clear:both">&copy; Documentation generated by <a href="http://raptorjs.org/jsdoc" target="_blank">Raptor JSDoc</a></div></div><script type="text/javascript" src="static/core-b80e8d87.js"></script>
<script type="text/javascript" src="static/jquery-371da524.js"></script>
<script type="text/javascript" src="static/jsdoc-ff81c58a.js"></script>
<script type="text/javascript" src="static/widgets-7dc6a28f.js"></script>
<script type="text/javascript" src="static/type-b348694c.js"></script><script type="text/javascript">$rwidgets(
["components.jsdoc.Nav.NavWidget","w0",{},0,0,0]);</script><script type="text/javascript">sh_highlightDocument();</script></body></body>