 <!DOCTYPE html><html><head><title itemprop="name">RaptorJS: Packaging Developer Guide</title><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" type="text/css" href="/static/font-awesome-87349705.css">
<link rel="stylesheet" type="text/css" href="/static/packaging-developer-guide-26dcd56c.css">
<link rel="stylesheet" type="text/css" href="/static/docs-6e628a8c.css">
<link rel="stylesheet" type="text/css" href="/static/code-editor-f1386401.css">
<script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-33982282-1"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
var __insp=__insp||[];__insp.push(["wid",2568045892]),function(){function e(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.id="inspsync",e.src=("https:"==document.location.protocol?"https":"http")+"://www.inspectlet.com/inspectlet-jq.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}window.attachEvent?window.attachEvent("onload",e):window.addEventListener("load",e,!1)}();</script></head><body><div class="navbar navbar-fixed-top"><div class="navbar-inner"><div class="container"><a class="brand" href="/">RaptorJS</a><ul class="nav"><li class="divider-vertical"></li><li id="w0"><a href="/get-started/">Get Started</a></li><li class="divider-vertical"></li><li id="w1" class="dropdown"><a data-toggle="dropdown" class="dropdown-toggle">Learn<b class="caret"></b></a><ul class="dropdown-menu"><li id="w2"><a href="/">Overview</a></li><li id="w3"><a href="/get-started/">Get Started</a></li><li id="w4"><a href="/tutorial/">Tutorial</a></li><li id="w5"><a href="/api/">API Reference</a></li><li id="w6"><a target="_blank" href="https://github.com/raptorjs/samples">Sample Apps</a></li><li id="w7"><a href="/faq/">FAQ</a></li><li class="divider"></li><li id="w8"><a href="/modules-classes/">Modules and Classes</a></li><li id="w9"><a href="/packaging/">Packaging and Extensions</a></li><li id="w10"><a href="/module-loader/">Module Loader</a></li><li id="w11"><a href="/optimizer/">Optimizer</a></li><li id="w12"><a href="/raptor-templates/">Raptor Templates</a></li><li id="w13"><a href="/widgets/">Widget Framework</a></li><li class="divider"></li><li id="w14"><a href="/ui-components/">Building UI Components</a></li><li id="w15"><a href="/logging/">Logging</a></li><li id="w16"><a href="/resource-search-path/">Resource Search Path</a></li></ul></li><li class="divider-vertical"></li><li id="w17" class="dropdown"><a data-toggle="dropdown" class="dropdown-toggle">Community<b class="caret"></b></a><ul class="dropdown-menu"><li id="w18"><a href="https://github.com/raptorjs/raptorjs">Source code</a></li><li id="w19"><a href="https://github.com/raptorjs/raptorjs/issues">Issue Tracker</a></li><li id="w20"><a href="/contribute/">Contribute</a></li><li id="w21"><a href="/contributors/">Contributors</a></li><li class="divider"></li><li id="w22"><a href="http://groups.google.com/group/raptorjs">Discussion Forum</a></li><li class="divider"></li><li id="w23"><a href="http://twitter.com/raptorjs">Twitter (@raptorjs)</a></li><li id="w24"><a href="https://plus.google.com/111493691067944627473/">Google+</a></li><li class="divider"></li><li id="w25"><a href="https://github.com/raptorjs/branding">Logos</a></li></ul></li><li class="divider-vertical"></li><li id="w26" class="dropdown"><a data-toggle="dropdown" class="dropdown-toggle">About<b class="caret"></b></a><ul class="dropdown-menu"><li id="w27"><a href="https://github.com/raptorjs/raptorjs/wiki/Release-Notes">Release Notes</a></li><li id="w28"><a href="/design-philosophy/">Design Philosophy</a></li><li id="w29"><a target="_blank" href="https://github.com/raptorjs/raptorjs/blob/master/LICENSE.md">License</a></li><li id="w30"><a href="/credits/">Credits</a></li><li id="w31"><a href="/creators/">Creators</a></li></ul></li><li class="divider-vertical"></li></ul></div></div></div><div class="container"><div class="docs"><div class="bd"><div class="docs-content"><h1 id="title">Packaging Developer Guide</h1><div class="toc nav" id="docsNav"><ul class="toc"><li class="toc toc-level-0"><a href="#Overview">Overview</a><ul class="toc"></ul></li><li class="toc toc-level-0"><a href="#Package_Format">Package Format</a><ul class="toc"><li class="toc toc-level-1"><a href="#Sample_RaptorJS_Package">Sample RaptorJS Package</a><ul class="toc"></ul></li><li class="toc toc-level-1"><a href="#DependenciesFormat">Dependencies Format</a><ul class="toc"></ul></li><li class="toc toc-level-1"><a href="#Extensions_Format">Extensions Format</a><ul class="toc"><li class="toc toc-level-2"><a href="#ExtensionConditions">Extension Conditions</a><ul class="toc"></ul></li></ul></li></ul></li><li class="toc toc-level-0"><a href="#Module_Dependencies">Module Dependencies</a><ul class="toc"><li class="toc toc-level-1"><a href="#Resolving_Module_package_json_Files">Resolving Module package.json Files</a><ul class="toc"></ul></li><li class="toc toc-level-1"><a href="#Module_Path_Mappings">Module Path Mappings</a><ul class="toc"></ul></li></ul></li><li class="toc toc-level-0"><a href="#Extensions">Extensions</a><ul class="toc"><li class="toc toc-level-1"><a href="#ExtensionNames">Extension Names</a><ul class="toc"></ul></li><li class="toc toc-level-1"><a href="#EnablingExtensions">Enabling Extensions</a><ul class="toc"></ul></li></ul></li><li class="toc toc-level-0"><a href="#TopLevelPackages">Top-level Packages</a><ul class="toc"></ul></li><li class="toc toc-level-0"><a href="#Package_Dependency_Types">Package Dependency Types</a><ul class="toc"><li class="toc toc-level-1"><a href="#RegisteringDependencyTypes">Registering Dependency Handlers</a><ul class="toc"></ul></li></ul></li><li class="toc toc-level-0"><a href="#Discussion">Discussion</a><ul class="toc"></ul></li></ul><div class="docs-nav-footer"><ul><li><span class="powered-by">Powered by <a href="/" class="raptorjs">RaptorJS</a></span></li><li><a href="/license/">License</a></li><li><a href="/credits/">Credits</a></li></ul></div></div><div class="section section-level-0"><h2 id="Overview">Overview</h2><div class="bd"><p>RaptorJS extends the popular <code>package.json</code> format so that it is better suited for packaging up code to be delivered to a
browser
<i>and</i> be loaded in multiple server-side JavaScript environments (Node, Rhino, etc.).
RaptorJS packages allows developers to make dependencies explicitâ€”including
which dependencies are environment-specific. This information is used for both
loading modules on the server and for distributing modules to the
browser.</p><p>RaptorJS packages can be created for JavaScript modules, UI components, etc.
RaptorJS imposes no requirements on the code that is packaged so developers can
continue to write code however they prefer. RaptorJS packages are extensible
and support any type of dependency ( JavaScript, CSS,
<a href="http://lesscss.org/">LESS</a>, <a href="/raptor-templates/">Raptor Templates</a>, etc.).</p><p>RaptorJS includes a module loader for Node and Rhino that inspects RaptorJS
packages to determine how to load JavaScript modules on the server. The
<a href="/optimizer/"><nobr>RaptorJS Optimizer</nobr></a> uses RaptorJS packages to determine which resources need to be optimized for
delivery to web browsers. Lastly, the client-side
<a href="/module-loader/get-started-async/"><nobr>RaptorJS Async Loader</nobr></a> uses information from packages to optimally download packages asynchronously.</p></div></div><div class="section section-level-0"><h2 id="Package_Format">Package Format</h2><div class="bd"><p>The RaptorJS package format extends the <a href="http://wiki.commonjs.org/wiki/Packages/1.0#Package_Descriptor_File">CommonJS Packages 1.0 Specification</a> format in a compatible way. RaptorJS package and a standard CommonJS package
is that a RaptorJS package introduces a new top-level
<code>raptor</code> property. The value of the <code>raptor</code> property is an object that may contain two nested properties:</p><ul><li><b>dependencies</b>: An array of RaptorJS dependencies.</li><li><b>extensions</b>: An array of named extensions, each which contains additional
environment-specific
dependencies.</li></ul><div class="section section-level-1"><h2 id="Sample_RaptorJS_Package">Sample RaptorJS Package</h2><div class="bd"><p>A sample RaptorJS package is shown below:</p><div class="code-editor" id="w32"> <textarea id="w32-textarea" style="display: none;" name="code-0">{
    "name": "my-module",
    "version": "1.0",
    "description": "My amazing module.",
    "raptor": {
        "dependencies": [
            { "module": "another-module" },
            "my-module-common.js",
        ],
        "extensions": [
            {
                "name": "server",
                "dependencies": [
                    "my-module-server.js"
                ]
            },
            {
                "name": "browser",
                "dependencies": [
                    "my-module.less"
                ]
            }
        ]
    }   
}</textarea></div></div></div><div class="section section-level-1"><h2 id="DependenciesFormat">Dependencies Format</h2><div class="bd"><p>Dependencies are provided as an array to maintain order. Each dependency may be
a complex JSON
<code>object</code> or a simple JSON <code>string</code>. When a dependency is provided as an <code>object</code>, the <code>type</code> property is used to determine the dependency type. For example:</p><div class="code-editor" id="w33"> <textarea id="w33-textarea" style="display: none;" name="code-1">"dependencies": [
    { "type": "module", "name": "my-module" },
    { "type": "js", "path": "widget.js" }
]</textarea></div><p>RaptorJS packages support a short-hand for resource dependencies by allowing
the dependency to be provided as a simple
<code>string</code> path. When a <code>string</code> dependency is encountered the file extension is used to determine the type.
For
example:</p><div class="code-editor" id="w34"> <textarea id="w34-textarea" style="display: none;" name="code-2">"dependencies": [
    "widget.js"
]</textarea></div><p>If a <code>string</code> dependency does not have a file extension then it is treated as a module name.
For
example:</p><div class="code-editor" id="w35"> <textarea id="w35-textarea" style="display: none;" name="code-3">"dependencies": [
    "my-module"
]</textarea></div><p>Lastly, a few additional short-hand dependencies are supported as shown below:</p><ul><li><b>Module</b>: <code>{ "module": "my-module" }</code></li><li><b>Resource</b>: <code>{ "path": "widget.js" }</code></li></ul></div></div><div class="section section-level-1"><h2 id="Extensions_Format">Extensions Format</h2><div class="bd"><p>Extensions are provided as an array of objects using the <code>extensions</code> property as a property of the top-level <code>raptor</code> object. Each extension supports the following properties:</p><ul><li><b>name</b>: The name of the extension. The name of the extension is arbitrary, but there
are a few well-defined names such as "server", "browser", "node", "rhino", etc.
The dependencies associated with an extension will only be included if an
extension with the provided name is
<a href="#EnablingExtensions">enabled</a>. For more details on extension names see <a href="#ExtensionNames">Extension Names below</a>.</li><li><b>dependencies</b>: An array of dependencies. See <a href="#DependenciesFormat">Dependencies Format</a> above for details.</li><li><b>condition</b>: A JavaScript that will be evaluated at runtime to determine if the
dependencies for the extension should be included. See
<a href="#ExtensionConditions">Extension Conditions</a> below for details.</li></ul><div class="section section-level-2"><h2 id="ExtensionConditions">Extension Conditions</h2><div class="bd"><p>An extension definition can also include a <code>condition</code> property that defines a JavaScript expression that is evaluated at runtime to
determine whether or not the dependencies for the extension should be included.
An example extension with a "condition" is shown
below:</p><div class="code-editor" id="w36"> <textarea id="w36-textarea" style="display: none;" name="code-4">{
    
    "raptor": {
        
        "extensions": [
            {
                "name": "my-extension",
                "condition": "!extensions.contains('jquery')",
                "dependencies": [
                    "no-jquery.js"
                ]
            }
        ]
    }   
}</textarea></div><p>When using extension conditions, <code>extensions</code> is an object that represents the list of enabled extensions. For more details,
see the API docs for
<a href="http://raptorjs.org/api/raptor/packaging/ExtensionCollection/">raptor/packaging/ExtensionCollection</a>.</p><p>Any valid JavaScript expression is allowed, but the JavaSript expression should
only make use of the provided
<code>extensions</code> object. A slightly more complex condition is shown below:</p><div class="code-editor" id="w37"> <textarea id="w37-textarea" style="display: none;" name="code-5">"condition": "!extensions.contains('jquery') &amp;&amp; extensions.contains('mobile')"</textarea></div><div class="message message-info"><div class="icon"><i class="icon-info-sign" style="font-size: 30px;"></i></div><div class="bd"><p>If an extension condition is provided, then the extension name is not used to
determine if the extension is enabled (only the condition is
used).</p></div></div></div></div></div></div></div></div><div class="section section-level-0"><h2 id="Module_Dependencies">Module Dependencies</h2><div class="bd"><p>RaptorJS packages allow transitive dependencies to be declared. Transitive
dependencies can be declared by adding another module as a dependency. Every
RaptorJS module is expected to have a corresponding
<code>package.json</code> file that describes the dependencies for the module. RaptorJS resolves a
module name to a
<code>package.json</code> file based on the name of the module. That is, the <code>package.json</code> is expected to be located in a directory based on the module name.</p><div class="section section-level-1"><h2 id="Resolving_Module_package_json_Files">Resolving Module package.json Files</h2><div class="bd"><p>RaptorJS will try a few different possible resource paths when trying to
resolve a module name to a
<code>package.json</code> file. For a module named "some/namespace/my-module", the <code>package.json</code> should be placed in one of the following locations:</p><ol><li>&lt;path-to-modules>/some/namespace/my-module/package.json</li><li>&lt;path-to-modules>/some/namespace/my-module-package.json</li></ol><p>The second usage (i.e. "my-module-package.json"), allows multiple packages to
be placed in the same
directory.</p></div></div><div class="section section-level-1"><h2 id="Module_Path_Mappings">Module Path Mappings</h2><div class="bd"><p>To bypass the default module package resolution steps, a module name can be
mapped to a
<code>package.json</code> file by adding the mapping to a <a href="#TopLevelPackages">top-level <code>package.json</code></a> file. For example:</p><div class="code-editor" id="w38"> <textarea id="w38-textarea" style="display: none;" name="code-6">{
    "raptor": {

        "module-mappings": {
            "my-module": "/some/path/to-module-package.json",
            ...
        }
    }
}</textarea></div></div></div></div></div><div class="section section-level-0"><h2 id="Extensions">Extensions</h2><div class="bd"><p>Extensions represent conditional environment-specific dependencies. If a
condition is not provided for an extension then the extension name is used to
determine if the dependencies for the extension should be included. If an
extension name is marked as enabled then the dependencies associated with the
extension will be enabled, otherwise they will be
ignored.</p><div class="section section-level-1"><h2 id="ExtensionNames">Extension Names</h2><div class="bd"><p>Extension names are arbitrary strings. An application can choose to enable any
set of arbitrary extension names. For example, an application might decide to
introduce an extension named "tablet" to define dependencies that are specific
to table
devices.</p><p>There are, however, well-known extension names for the various environments:</p><ul><li><b>server</b> - Enabled for any server-side JavaScript environment (e.g. Node and Rhino)</li><li><b>node</b> - Enabled for Node only</li><li><b>rhino</b> - Enabled for Rhino only</li><li><b>browser</b> - Enabled for the browser only</li><li><b>jquery</b> - Enabled for environments that have jQuery loaded</li><li><b>development</b> - Enabled for development (i.e. non-production) environments only</li></ul></div></div><div class="section section-level-1"><h2 id="EnablingExtensions">Enabling Extensions</h2><div class="bd"><p>RaptorJS package files are read by the server-side <a href="/module-loader/"><nobr>RaptorJS JavaScript Module Loader</nobr></a> and the <a href="/optimizer/"><nobr>RaptorJS Optimizer</nobr></a>. To enable extensions for modules loaded on the server, the following code can
be
used:</p><div class="code-editor" id="w39"> <textarea id="w39-textarea" style="display: none;" name="code-7">require('raptor/packaging').enableExtension('myExtension');</textarea></div><p>Please see the documentation for the <a href="/optimizer/">RaptorJS Optimizer</a> for configuring which extensions are enabled during the optimization process.</p></div></div></div></div><div class="section section-level-0"><h2 id="TopLevelPackages">Top-level Packages</h2><div class="bd"><p>Top-level packages are packages named <code>package.json</code> and placed in the root of a <a href="/resource-search-path/">Resource Search Path</a> entry. Various modules that are part of RaptorJS use top-level packages to
discover certain information at runtime. The RaptorJS
<a href="http://raptorjs.org/api/raptor/packaging/">raptor/packaging</a> module provides a helper <code>forEachTopLevelPackageManifest</code> that can be used to iterate over all of the cached top-level packages as shown
in the following
code:</p><div class="code-editor" id="w40"> <textarea id="w40-textarea" style="display: none;" name="code-8">packaging.forEachTopLevelPackageManifest(function(manifest) {
    var taglibs = manifest.getRaptorProp('taglibs');
    if (taglibs) {
        ...
    }
}, this);</textarea></div><p>Please see the following source file that illustrates how the <a href="/raptor-templates/">Raptor Templates</a> compiler discovers taglibs: <a href="https://github.com/raptorjs/raptorjs/blob/master/lib/raptor/templating/compiler/compiler_server.js"><nobr>raptor/templating/compiler/compiler_server.js</nobr></a></p></div></div><div class="section section-level-0"><h2 id="Package_Dependency_Types">Package Dependency Types</h2><div class="bd"><p>RaptorJS relies on registered handlers for package dependency types to
determine how to handle dependencies. A dependency can either be a resource
dependency (i.e., either a JavaScript or CSS resource or a resource that
compiles into either JavaScript or CSS) or a package dependencncy (i.e., a
dependency that resolves to another
<code>package.json</code> file).</p><p>Every dependency handler must implement the <code>getContentType</code> method and only the two following values are allowed:</p><ul><li>application/javascript</li><li>text/css</li></ul><p>Resource dependency handlers must also implement the <code>getCode()</code> method. The output of the <code>getCode()</code> method should be either the JavaScript or CSS code for the resource. If the
dependency must be compiled into either JavaScript or CSS (e.g.
<a href="http://lesscss.org/">LESS</a> or <a href="/raptor-templates/">Raptor Templates</a>)</p><p>For examples of dependency handlers, please check out the following source code
directory for the
<code>raptor/packaging</code>: <a href="https://github.com/raptorjs/raptorjs/tree/master/lib/raptor/packaging">/lib/raptor/packaging</a></p><div class="section section-level-1"><h2 id="RegisteringDependencyTypes">Registering Dependency Handlers</h2><div class="bd"><p>Dependency type handlers can be registered inside any <a href="#TopLevelPackages">top-level <code>package.json</code> file</a>. The "dependency-types" property is used to register dependency type handlers.
For an example, please see the the core RaptorJS
<code>package.json</code> file for the RaptorJS library: <a href="http://raptorjs.org/api/source/package.json/">https://github.com/raptorjs/raptorjs/blob/master/lib/package.json</a></p></div></div></div></div><div class="section section-level-0"><h2 id="Discussion">Discussion</h2><div class="bd"><div id="disqus_thread"></div></div></div></div></div><div class="docs-footer-padding"></div></div></div><script type="text/javascript" src="/static/core-b80e8d87.js"></script>
<script type="text/javascript" src="/static/jquery-371da524.js"></script>
<script type="text/javascript" src="/static/widgets-7dc6a28f.js"></script>
<script type="text/javascript" src="/static/packaging-developer-guide-02c7930e.js"></script>
<script type="text/javascript" src="/static/code-editor-36478451.js"></script><script type="text/javascript">$rwidgets(
["components.nav.Nav.NavItemWidget","w0",0,0,0,0],
["components.nav.Nav.NavItemWidget","w1",0,0,0,0,
["components.nav.Nav.NavItemWidget","w2",0,0,0,0],
["components.nav.Nav.NavItemWidget","w3",0,0,0,0],
["components.nav.Nav.NavItemWidget","w4",0,0,0,0],
["components.nav.Nav.NavItemWidget","w5",0,0,0,0],
["components.nav.Nav.NavItemWidget","w6",0,0,0,0],
["components.nav.Nav.NavItemWidget","w7",0,0,0,0],
["components.nav.Nav.NavItemWidget","w8",0,0,0,0],
["components.nav.Nav.NavItemWidget","w9",0,0,0,0],
["components.nav.Nav.NavItemWidget","w10",0,0,0,0],
["components.nav.Nav.NavItemWidget","w11",0,0,0,0],
["components.nav.Nav.NavItemWidget","w12",0,0,0,0],
["components.nav.Nav.NavItemWidget","w13",0,0,0,0],
["components.nav.Nav.NavItemWidget","w14",0,0,0,0],
["components.nav.Nav.NavItemWidget","w15",0,0,0,0],
["components.nav.Nav.NavItemWidget","w16",0,0,0,0]],
["components.nav.Nav.NavItemWidget","w17",0,0,0,0,
["components.nav.Nav.NavItemWidget","w18",0,0,0,0],
["components.nav.Nav.NavItemWidget","w19",0,0,0,0],
["components.nav.Nav.NavItemWidget","w20",0,0,0,0],
["components.nav.Nav.NavItemWidget","w21",0,0,0,0],
["components.nav.Nav.NavItemWidget","w22",0,0,0,0],
["components.nav.Nav.NavItemWidget","w23",0,0,0,0],
["components.nav.Nav.NavItemWidget","w24",0,0,0,0],
["components.nav.Nav.NavItemWidget","w25",0,0,0,0]],
["components.nav.Nav.NavItemWidget","w26",0,0,0,0,
["components.nav.Nav.NavItemWidget","w27",0,0,0,0],
["components.nav.Nav.NavItemWidget","w28",0,0,0,0],
["components.nav.Nav.NavItemWidget","w29",0,0,0,0],
["components.nav.Nav.NavItemWidget","w30",0,0,0,0],
["components.nav.Nav.NavItemWidget","w31",0,0,0,0]],
["components/editors/CodeEditor/CodeEditorWidget","w32",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components/editors/CodeEditor/CodeEditorWidget","w33",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components/editors/CodeEditor/CodeEditorWidget","w34",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components/editors/CodeEditor/CodeEditorWidget","w35",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components/editors/CodeEditor/CodeEditorWidget","w36",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components/editors/CodeEditor/CodeEditorWidget","w37",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components/editors/CodeEditor/CodeEditorWidget","w38",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components/editors/CodeEditor/CodeEditorWidget","w39",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components/editors/CodeEditor/CodeEditorWidget","w40",{"mode":"javascript","autoResize":true,"readOnly":true,"indentUnit":4},0,0,0],
["components.social.Disqus.DisqusWidget","disqus_thread",{"shortName":"raptor-js","id":"packaging-developer-guide","title":"Packaging Developer Guide"},0,0,0]);</script></body></html>