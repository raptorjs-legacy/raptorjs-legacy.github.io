define("raptor/resources",function(e){"use strict";return{isResource:function(t){return t instanceof e("raptor/resources/Resource")}}});
define.Class("raptor/resources/Resource",["raptor"],function(e,t){"use strict";return{init:function(e,t){this.setSearchPathEntry(e),this.setPath(t)},lastModified:function(){throw e.createError("lastModified() not implemented for "+this.getClass().getName())},setPath:function(e){this.path=e},getPath:function(){return this.path},getExtension:function(){var e=this.path,t=e.lastIndexOf(".");return t===-1?"":e.substring(t+1)},isFileResource:function(){return!1},getName:function(){return this._name==null&&(this._name=this.path.substring(this.path.lastIndexOf("/")+1)),this._name},getURL:function(){throw e.createError(new Error("getURL() Not Implemented in "+this.getClass().getName()))},readAsString:function(t){throw e.createError(new Error("Not Implemented"))},toString:function(){var e;try{e=this.getURL()}catch(t){e=""}return"["+this.getClass().getName()+": path="+this.getPath()+", systemPath="+e+"]"},exists:function(){return!0},findChild:function(e){var n=t("raptor/resources");return n.findResource(n.joinPaths(this.getPath(),e))},setSearchPathEntry:function(e){this.searchPathEntry=e},getSearchPathEntry:function(){return this.searchPathEntry},getDirPath:function(){if(!this.dirPath){var e=this.getPath(),t=e.match(/[\\\/][^\\\/]+$/);this.dirPath=e.substring(0,t.index)}return this.dirPath},getParent:function(){throw e.createError(new Error("getParent() Not Implemented"+this.getClass().getName()))},resolve:function(t,n){throw e.createError(new Error("resolve() Not Implemented for "+this.getClass().getName()))},watch:function(){}}});
define.Class("raptor/resources/MissingResource","raptor/resources/Resource",function(e){"use strict";var t=function(e){t.superclass.constructor.call(this,null,e)};return t.prototype={exists:function(){return!1}},t});
define("raptor/resources/BrowserResource","raptor/resources/Resource",function(e,t,n){"use strict";var r=function(e,t,n){r.superclass.constructor.call(this,e,t),this.path=t,this.contents=n};return r.prototype={readAsString:function(){return this.contents},getURL:function(){return this.path}},r});
define.extend("raptor/resources",function(e){"use strict";var t=e("raptor/logging").logger("raptor/resources"),n=e("raptor/resources/Resource"),r=e("raptor/resources/MissingResource"),i=e("raptor/resources/BrowserResource");return{findResource:function(e){if(e instanceof n)return e;var t=$rget("resource",e);return t?new i(null,e,t):new r(e)}}});
define("raptor/regexp",function(e){"use strict";var t={"*":".*?","?":".?"};return{escape:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},simple:function(e){var n=this;return new RegExp("^"+e.replace(/[\*\?]|[^\*\?]*/g,function(e){return t[e]||n.escape(e)})+"$")}}});
define("raptor/objects",["raptor"],function(e){"use strict";return{extend:e.extend,forEachEntry:e.forEachEntry,keys:function(e){return Object.keys(e)},values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},entries:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({key:n,value:e[n]});return t},isEmpty:function(e){if(!e)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}}});
define("raptor/json/stringify",["raptor"],function(e,t,n,r){"use strict";var i=t("raptor/strings"),s=i.unicodeEncode,o=",",u="null",a=Array,f=/([^ -~]|(["'\\]))/g,l={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"},c=function(e){return e<10?"0"+e:e},h=function(e){return e.getUTCFullYear()+"-"+c(e.getUTCMonth()+1)+"-"+c(e.getUTCDate())+"T"+c(e.getUTCHours())+":"+c(e.getUTCMinutes())+":"+c(e.getUTCSeconds())+"Z"},p=function(e,t){t||(t={});var n=t.special||f,r=i.createStringBuilder(),c=function(e){r.append(e)},p=t.useSingleQuote===!0,d=p===!0?"'":'"',v=function(e){return d+e.replace(n,function(e){if(e==='"')return p?'"':'\\"';if(e==="'")return p?"\\'":"'";var t=l[e];return t||s(e)})+d},m=function(e){if(e==null){c(u);return}var t=e.constructor,n,r;if(e===!0||e===!1||t===Boolean)c(e.toString());else if(t===a){c("["),r=e.length;for(n=0;n<r;n++)n!==0&&c(o),m(e[n]);c("]")}else if(t===Date)c(h(e));else{var i=typeof e;switch(i){case"string":c(v(e));break;case"number":c(isFinite(e)?e+"":u);break;case"object":c("{");var s=!0,f;for(var l in e)if(e.hasOwnProperty(l)){f=e[l];if(f==null)continue;s===!1?c(o):s=!1,c(v(l)),c(":"),m(f)}c("}");break;default:c(u)}}};return m(e),r.toString()};return p.stringify=p,p});
define("raptor/xml/dom",function(e,t,n){"use strict";return{createParser:function(t){var n=e("raptor/xml/dom/DomParser");return new n(t)}}});
define.Class("raptor/xml/dom/DomParser",function(e){"use strict";var t=function(e){};return t.prototype={parse:function(e){try{var t=$.parseXML(e);return t}catch(n){throw new Error("Invalid XML")}}},t});
define("raptor/xml/sax",function(e,t,n){"use strict";return{createParser:function(t){t=t||{};if(t.dom)return this.createParserForDom(t);var n=e.find("raptor/xml/SaxParser")||e.find("raptor/xml/sax/SaxParserDom");return new n(t)},createParserForDom:function(t){var n=e("raptor/xml/sax/SaxParserDom");return new n(t)}}});
define.Class("raptor/xml/sax/BaseSaxParser",["raptor"],function(e,t){"use strict";var n=t("raptor/listeners"),r=e.arrayFromArguments,i=function(){this.observable=n.createObservable(["startElement","endElement","characters","cdata","comment","error"])};return i.prototype={on:function(e,t){this.observable.subscribe.apply(this.observable,arguments)},_startElement:function(e){this.observable.publish("startElement",e)},_endElement:function(e){this.observable.publish("endElement",e)},_characters:function(e){e=e.replace(/\r\n|\r/g,"\n"),this.observable.publish("characters",e)},_cdata:function(e){e=e.replace(/\r\n|\r/g,"\n"),this.observable.publish("cdata",e)},_comment:function(e){this.observable.publish("comment",e)},_error:function(){var e=r(arguments);this.observable.publish("error",e)},getPos:function(){return"(unknown)"}},i});
define("raptor/xml/dom-to-sax",["raptor"],function(e,t,n,r){"use strict";var i=function(e){this.node=e};i.prototype={getNamespaceURI:function(){return this.node.namespaceURI||""},getLocalName:function(){return this.node.localName},getQName:function(){return this.node.prefix?this.node.prefix+":"+this.node.localName:this.node.localName},getValue:function(){return this.node.nodeValue},getPrefix:function(){return this.node.prefix},toString:function(){return"[Attribute: uri="+this.getNamespaceURI()+", qName="+this.getQName()+", value="+this.getValue()+"]"}};var s=function(e){this.node=e};return s.prototype={getNamespaceURI:function(){return this.node.namespaceURI||""},getLocalName:function(){return this.node.localName},getQName:function(){return this.node.prefix?this.node.prefix+":"+this.node.localName:this.node.localName},getPrefix:function(){return this.node.prefix||""},getAttributes:function(){var e=this.attributes;if(!e){e=this.attributes=[];var t=this.node.attributes;for(var n=0,r=t.length;n<r;n++)e.push(new i(t.item(n)))}return e},getNamespaceMappings:function(){var t=this._namespaceMappings;return t||(t=this._namespaceMappings={},e.forEach(this.getAttributes(),function(e){e.getPrefix()==="xmlns"&&(t[e.getLocalName()]=e.getValue())},this)),t},toString:function(){var t=[];return e.forEach(this.getAttributes(),function(e){t.push(e.toString())},this),t=t.join(", "),"[Element: uri="+this.getNamespaceURI()+", localName="+this.getLocalName()+", qName="+this.getQName()+", prefix="+this.getPrefix()+", attributes=["+t+"], ns="+JSON.stringify(this.getNamespaceMappings())+"]"}},{domToSax:function(e,n,r){var i=t("raptor/listeners").createObservable(["startElement","endElement","comment","characters"],!0);i.subscribe(n,r);var o=function(e){i.characters(e.nodeValue)},u=function(e){i.comment(e.nodeValue)},a=function(e){var t=new s(e);i.startElement(t);var n=e.childNodes,r=n.length;for(var o=0;o<r;o++){var u=n[o];f(u)}i.endElement(t)},f=function(e){switch(e.nodeType){case 1:a(e);break;case 2:break;case 3:o(e);break;case 4:o(e);break;case 5:o(e);break;case 6:o(e);break;case 7:break;case 8:u(e);break;case 9:a(e.documentElement)}};f(e)}}});
define.Class("raptor/xml/sax/SaxParserDom","raptor/xml/sax/BaseSaxParser",["raptor"],function(e,t){"use strict";var n=function(e){n.superclass.constructor.call(this)};return n.prototype={parse:function(e,n){var r;if(e.documentElement)r=e;else{var i=t("raptor/xml/dom").createParser();r=i.parse(e,n)}t("raptor/xml/dom-to-sax").domToSax(r.documentElement,{startElement:this._startElement,endElement:this._endElement,comment:this._comment,characters:this._characters},this)}},n});
define("raptor/arrays",["raptor"],function(e,t){"use strict";var n=Array,r=n.isArray,i=e.arrayFromArguments;return{forEach:e.forEach,isArray:r,fromArguments:i,arrayFromArguments:i,concatArrays:function(e){var t=[],n=0,r=arguments.length,i;for(;n<r;n++)i=arguments[n],i!=null&&(t=t.concat.apply(t,i));return t},pop:function(e){var t=this.peek(e);return e.splice(e.length-1,1),t},peek:function(e){return e&&e.length?e[e.length-1]:undefined}}});
define("raptor/xml/sax/object-mapper",["raptor"],function(e,t,n,r){"use strict";var i=t("raptor/xml/sax"),s=e.forEachEntry,o=t("raptor/arrays"),u=t("raptor/strings"),a="string",f="boolean",l="object",c="number",h="integer",p="int",d=function(e,t,n){var r=function(e){var r;return t==="attribute"?r=n["@"+e]:t==="element"&&(r=n["<"+e+">"]),r||(r=n[e]),r},i=e.getNamespaceURI(),s;return i?(s=r(i+":"+e.getLocalName()),s||(s=r(i+":*"))):s=r(e.getLocalName()),s||(s=r("*")),typeof s=="function"&&(s=s(e,t)),s},v=function(e,t){var n=[];return s(e,function(e,r){if(u.startsWith(e,"_"))return;if(t&&r._type===l)return;n.push(t?e:e.charAt(0)==="<"?e:"<"+e+">")},this),"["+n.join(", ")+"]"},m=function(e,t){t||(t={}),this.skipping=!1,this.options=t,this.trimText=t.trimText!==!1,this.normalizeText=t.normalizeText!==!1,this.contextStack=[],this.schema=e};return m.prototype={_parseProp:function(e,t){var n=this.options.parseProp;return n&&(e=n(e,t)),e},_setProperty:function(e,t,n,r,i){if(typeof t=="function"){t(n,r,i);return}if(typeof r=="string"){if(this.trimText){r=u.trim(r);if(!r)return}r=this._parseProp(r,i),t._type===f?r.length===0?r=undefined:(r=r.toLowerCase(),r=r==="true"||r==="yes"):t._type===h||t._type===p?r=parseInt(r,10):t._type===c&&(r=parseFloat(r))}var s=t._targetProp;!s&&this.options.defaultTargetProp&&(s=this.options.defaultTargetProp(i)),s||(s=typeof e=="string"?e:e.getNamespaceURI()?e.getNamespaceURI()+":"+e.getLocalName():e.getLocalName());if(t._set)t._set(n,s,r,i);else{var o="set"+s.substring(0,1).toUpperCase()+s.substring(1);n[o]?n[o](r):n[s]=r}},skipCurrentElement:function(){if(this.skipping)return;var e=this.getCurrentContext();e.skip=!0,this.skipping=!0},error:function(t){throw e.createError(new Error(t+" ("+this.saxParser.getPos()+")"))},getCurrentContext:function(){return o.peek(this.contextStack)},read:function(t,n){this.saxParser=i.createParser({trim:this.trimText,normalize:this.normalizeText}),this.contextStack=[],this.skipping=!1;var r=this,s,c=this.saxParser,h=function(e){if(r.skipping===!0)return;var t=r.getCurrentContext();if(!t){if(!u.trim(e))return;r.error("Unexpected text: "+e)}t.text=t.text?t.text+e:e};return c.on({error:function(e){r.error(e)},startElement:function(t){var n=r.getCurrentContext(),i=n?n.schema:r.schema,s;if(n&&i&&n.text){var o=u.trim(n.text);i._type===l?i._text?r._setProperty("text",i._text,n.object,n.text,n):i._setText?i._setText(n.object,r._parseProp(n.text,n)):o&&r.error("Unexpected text: "+n.text):o&&r.error("Unexpected text: "+n.text),n.text=null}var c={el:t,name:t.getQName(),tagName:t.getLocalName(),localName:t.getLocalName(),uri:t.getNamespaceURI(),parentContext:n};r.contextStack.push(c);if(r.skipping)return;c.schema=s=d(t,"element",i);if(!s){var h=t.getNamespaceURI()?t.getNamespaceURI()+":"+t.getLocalName():t.getLocalName();r.error("Unexpected element: <"+h+">. Expected one of: "+v(i))}if(s._type===a||s._type===f)s._begin&&s._begin(n?n.object:null,c);else if(s._type===l){c.object=s._begin?s._begin(n?n.object:null,c)||{}:{};if(!c.object)throw new Error('_begin() for "'+t.getLocalName()+'" did not return an object.')}if(!r.skipping){var p=t.getAttributes();for(var m=0,g=p.length,y;m<g;m++){y=p[m];if(r.skipping)break;var b=d(y,"attribute",s);b||r.error("Unexpected attribute: "+y.getQName()+". Expected one of: "+v(s,!0));var w=e.extend({},c);w.attr=y,w.localName=y.getLocalName(),w.uri=y.getNamespaceURI(),w.name=y.getQName(),r._setProperty(y,b,c.object,y.getValue(),w)}}},characters:function(e){h(e)},cdata:function(e){h(e)},endElement:function(){var e=r.getCurrentContext(),t=e.parentContext,n=e.schema;if(r.skipping!==!0)if(n._type===a||n._type===f)r._setProperty(e.el,n,t?t.object:null,e.text,e),n._end&&n._end(e.object,t?t.object:null,e);else if(n._type===l){if(e.text!=null){var i=u.trim(e.text);n._text?r._setProperty("text",n._text,e.object,e.text,e):n._setText?n._setText(e.object,r._parseProp(e.text,e)):i&&r.error("Unexpected text: "+e.text)}n._end&&n._end(e.object,t?t.object:null,e),n._targetProp&&r._setProperty(e.el,n,t?t.object:null,e.object)}else if(n._type)throw new Error("Invalid type: "+n._type);r.contextStack.length===1&&(s=e.object),o.pop(r.contextStack),e.skip===!0&&(r.skipping=!1)}}),c.parse(t,n),s}},{createReader:function(e,t){return new m(e,t)},read:function(e,t,n,r){return this.createReader(n,r).read(e,t)}}});
define("raptor/temp",function(e){"use strict";return{}});
define.Class("raptor/templating/compiler/Expression",["raptor"],function(e,t){"use strict";var n=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|\s+(?:and|or|lt|gt|eq|ne|lt|gt|ge|le)\s+/g,r=t("raptor/strings"),i={and:" && ",or:" || ",eq:" === ",ne:" !== ",lt:" < ",gt:" > ",ge:" >= ",le:" <= "},s=function(e){return e.replace(n,function(e){return i[r.trim(e)]||e})},o=function(t,n){if(t==null)throw e.createError(new Error("expression argument is required"));n!==!1&&typeof t=="string"&&(t=s(t)),this.expression=t};return o.prototype={getExpression:function(){return this.expression},toString:function(){return this.expression.toString()}},o});
define.Class("raptor/templating/compiler/ExpressionParser",["raptor"],function(e,t){"use strict";var n=t("raptor/templating/compiler/Expression"),r=t("raptor/strings"),i=t("raptor/json/stringify"),s=t("raptor/regexp"),o={"${":"}","$!{":"}","{%":"%}","{?":"}",$:null,"$!":null},u=function(t){var n=[];return e.forEach(t,function(e){n.push(s.escape("\\\\"+e)),n.push(s.escape("\\"+e)),n.push(s.escape(e))}),n.join("|")},a=u(["{%","${","$!{","$!","$","{?"]),f=function(){return new RegExp(a,"g")},l=function(e,t){var n=e.split("\n"),r=0,i;while(r<n.length){i=n[r];if(t-i.length+1<0)break;t-=i.length+1,r++}return{str:i,pos:t}},c=function(e,t,n){var r=l(e,t);t=r.pos,e=r.str;var i=t-n,s=t+n,o;i<0&&(i=0),s>e.length&&(s=e.length);var u="...",a="...",f="\n"+u+e.substring(i,s)+a+"\n";for(o=0;o<u.length;o++)f+=" ";for(o=i;o<s;o++)f+=o===t?"^":" ";for(o=0;o<a.length;o++)f+=" ";return f},h=function(e){var t=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|\\\\;|\\;|[\{\};]/g,n,r=0,s=[],o=0;while(n=t.exec(e)){if(n[0]==="{"){r++;continue}if(n[0]==="}"){if(r!==0){r--;continue}}else{if(n[0]==="\\\\;"){e=e.substring(0,n.index)+"\\;"+e.substring(t.lastIndex),t.lastIndex=n.index+1;continue}if(n[0]==="\\;"){e=e.substring(0,n.index)+";"+e.substring(t.lastIndex),t.lastIndex=n.index+1;continue}n[0]===";"&&r===0&&(s.push(e.substring(o,n.index)),o=t.lastIndex)}}o<e.length&&s.push(e.substring(o));var u=function(e){var t=[];return v.parse(e,{text:function(e){t.push(i(e))},expression:function(e){t.push(e)}}),t.join("+")};if(s.length===1)return"("+s[0]+" ? "+"null"+" : '')";if(s.length===2)return"("+s[0]+" ? "+u(s[1])+" : '')";if(s.length===3)return"("+s[0]+" ? "+u(s[1])+" : "+u(s[2])+")";throw new Error('Invalid simple conditional of "'+e+'". Simple conditionals should be in the form {?<expression>;<true-template>[;<false-template>]}')},p=function(e,t){var n,r,i=function(e){r.push(u.quote+e+u.quote)},s=function(e){n=!0,r.push(e)};for(var o=t.length-1,u;o>=0;o--){u=t[o];if(!u.value)continue;n=!1,r=[],v.parse(u.value,{text:i,expression:s}),n&&(e=e.substring(0,u.start)+"("+r.join("+")+")"+e.substring(u.end))}return e},d=define.Class(function(){return{init:function(e,t){this.callback=e,this.callbackThisObj=t,this.prevText=null,this.prevEscapeXml=null},_invokeCallback:function(t,n,r){if(!this.callback[t])throw e.createError(new Error(t+" not allowed: "+n));this.callback[t].call(this.callbackThisObj,n,r)},_endText:function(){this.prevText!==null&&(this._invokeCallback("text",this.prevText,this.prevEscapeXml),this.prevText=null,this.prevEscapeXml=null)},addXmlText:function(e){this.addText(e,!1)},addText:function(e,t){this.prevText!==null&&this.prevEscapeXml===t?this.prevText+=e:(this._endText(),this.prevText=e,this.prevEscapeXml=t)},addXmlExpression:function(e,t){this.addExpression(e,!1)},addExpression:function(e,t){this._endText(),e instanceof n||(e=new n(e)),this._invokeCallback("expression",e,t!==!1)},addScriptlet:function(e){this._endText(),this._invokeCallback("scriptlet",e)}}}),v=function(){};return v.parse=function(t,n,i,s){s||(s={});var u=0,a,l,m,g,y,b,w,E,S=s.custom||{},x=function(t){if(n.error){n.error.call(i,t);return}throw e.createError(new Error(t))},T=f(),N=new d(n,i);T.lastIndex=0;e:while(l=T.exec(t)){if(r.startsWith(l[0],"\\\\"))a=l.index+1,E=l[0].substring(2),g=l.index+l[0].length;else{if(r.startsWith(l[0],"\\")){N.addText(t.substring(u,l.index)),N.addText(l[0].substring(1)),u=T.lastIndex;continue}if(!o.hasOwnProperty(l[0]))throw e.createError(new Error("Illegal state. Unexpected start token: "+l[0]));E=l[0],a=l.index}g=T.lastIndex,u!==a&&N.addText(t.substring(u,a));var C=o[E];if(!C){var k=/^([_a-zA-Z]\w*(?:\.[_a-zA-Z]\w*)*)/g;k.lastIndex=0;var L=k.exec(t.substring(g));if(!L){N.addText(l[0]),T.lastIndex=u=g;continue e}var A=L[1];E==="$!"?N.addXmlExpression(A):N.addExpression(A),T.lastIndex=u=g+=A.length;continue e}b=E==="{%",w=E==="{?";var O=/"((?:[^"]|\\")*)"|'((?:[^']|\\')*)'|\%\}|[\{\}]/g;O.lastIndex=g;var M=0,_=[],D;while(m=O.exec(t)){if(m[0]==="{"){M++;continue}if(m[0]==="}"){if(b)continue;if(M!==0){M--;continue}}else{if(m[0]!=="%}"){(m[0].charAt(0)==="'"||m[0].charAt(0)==='"')&&_.push({start:m.index-g,end:m.index+m[0].length-g,value:m[0].slice(1,-1),json:m[0],quote:m[0].charAt(0)});continue}b||x('Ending "'+m[0]+'" token was found but matched with starting "'+E+'" token. Location: '+c(t,m.index,10))}y=t.substring(g,m.index),D=null;if(E==="${"){var P=y.indexOf(":"),H;P!=-1&&(H=y.substring(0,P),D=S[H]||v.custom[H],D&&D.call(v,y.substring(P+1),N))}D||(b?N.addScriptlet(y):w?N.addExpression(h(y)):(_.length>0&&(y=p(y,_)),E==="$!{"?N.addXmlExpression(y):N.addExpression(y))),T.lastIndex=O.lastIndex,u=O.lastIndex;continue e}x('Ending "'+o[E]+'" token not found for "'+E+'" token. Location: '+c(t,l.index,10)+"\n")}u!==t.length&&N.addText(t.substring(u,t.length)),N._endText()},v.custom={xml:function(e,t){t.addXmlExpression(new n(e))},entity:function(e,t){t.addXmlText("&"+e+";")},startTag:function(e,t){t.addXmlText("<"+e+">")},endTag:function(e,t){t.addXmlText("</"+e+">")},newline:function(e,t){t.addText("\n")}},v});
define.Class("raptor/templating/compiler/TypeConverter",["raptor"],function(e,t){"use strict";var n=t("raptor/templating/compiler/ExpressionParser"),r=t("raptor/json/stringify"),i=t("raptor/templating/compiler/Expression"),s=function(){};return s.convert=function(t,s,o){var u=!1,a=[];if(t==null)return t;if(s==="custom"||s==="identifier")return t;if(s==="expression")return t===""&&(t="null"),new i(t);var f="";if(o){n.parse(t,{text:function(e){f+=e,a.push(r(e))},expression:function(e){a.push(e),u=!0}});if(u)return new i(a.join("+"));t=f}if(s==="string")return o?new i(t?r(t):"null"):t;if(s==="boolean")return o?new i(t):(t=t.toLowerCase(),t=t==="true"||t==="yes",t);if(s==="float"||s==="double"||s==="number"||s==="integer"||s==="int")return o?new i(t):(s==="integer"?t=parseInt(t,10):t=parseFloat(t),t);throw e.createError(new Error("Unsupported attribute type: "+s))},s});
define.Class("raptor/templating/compiler/AttributeSplitter",["raptor"],function(e,t){"use strict";var n=t("raptor/strings"),r=t("raptor/templating/compiler/Expression"),i=t("raptor/templating/compiler/TypeConverter"),s=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|==|===|[;=]/g,o=function(){};return o.parse=function(t,r,o){o||(o={});var u=0,a=o.ordered===!0,f=o.defaultName,l=o.removeDashes===!0,c,h=-1,p=a?[]:{},d=function(t){if(o.errorHandler){o.errorHandler(t);return}throw e.createError(new Error(t))},v=function(e){if(u===e)return;var s,o;if(h!=-1)s=n.trim(t.substring(u,h)),o=t.substring(h+1,e);else if(f){s=f,o=t.substring(u,e);if(!n.trim(o).length)return}else s=t.substring(u,e);s&&(s=n.trim(s));if(!n.trim(s).length&&!n.trim(o).length){h=-1;return}if(r){var c=r[s]||r["*"];c?(o!=null&&(o=i.convert(o,c.type,c.allowExpressions!==!1)),c.name&&(s=c.name)):d('Invalid sub-attribute name of "'+s+'"')}s&&l&&(s=s.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})),a?p.push({name:s,value:o}):p[s]=o,h=-1};while(c=s.exec(t))c[0]==";"?(v(c.index),u=c.index+1,h=-1):c[0]=="="&&h==-1&&(h=c.index);return v(t.length),p},o});
define.Class("raptor/templating/compiler/TemplateBuilder",["raptor"],function(e,t){"use strict";var n="  ",r=t("raptor/json/stringify"),i=t("raptor/strings"),s=t("raptor/templating/compiler/Expression"),o=e.forEach,u=function(e){this._indent=e!=null?e:n+n,this._code=i.createStringBuilder(),this.firstStatement=!0,this._bufferedText=null,this._bufferedContextMethodCalls=null};u.prototype={write:function(e){this.contextMethodCall("w",e)},text:function(e){this._bufferedText===null?this._bufferedText=e:this._bufferedText+=e},contextMethodCall:function(e,n){this.flushText(),this._bufferedContextMethodCalls||(this._bufferedContextMethodCalls=[]),n=t("raptor/arrays").arrayFromArguments(arguments,1),this._bufferedContextMethodCalls.push([e,n])},code:function(e){this.flush(),this._code.append(e)},statement:function(e){this.flush(),this.code((this.firstStatement?"":"\n")+this._indent+e+"\n"),this.firstStatement=!1},line:function(e){this.code(this._indent+e+"\n")},indentStr:function(e){if(arguments.length===0)return this._indent;var t=this._indent;for(var r=0;r<e;r++)t+=n;return t},indent:function(){if(arguments.length===0)this.code(this._indent);else if(arguments.length===1&&typeof arguments[0]=="number")this.code(this.indentStr(arguments[0]));else if(typeof arguments[0]=="function"||typeof arguments[1]=="function"){var e,t,n;typeof arguments[0]=="function"?(n=1,e=arguments[0],t=arguments[1]):(n=arguments[0],e=arguments[1],t=arguments[2]),this.incIndent(n),e.call(t),this.decIndent(n)}else typeof arguments[0]=="string"&&this.code(this._indent+arguments[0]);return this},flush:function(){this.flushText(),this.flushMethodCalls()},flushText:function(){var e=this._bufferedText;e&&(this._bufferedText=null,this.write(r(e,{useSingleQuote:!0})))},flushMethodCalls:function(){var t=this._bufferedContextMethodCalls;t&&(this.firstStatement||this._code.append("\n"),this.firstStatement=!1,this._bufferedContextMethodCalls=null,o(t,function(n,r){var i=n[0],o=n[1];r===0?this._code.append(this.indentStr()+"context."+i+"("):(this.incIndent(),this._code.append(this.indentStr()+"."+i+"(")),o.forEach(function(t,n){n!==0&&this._code.append(", ");if(typeof t=="string")this._code.append(t);else if(typeof t=="boolean")this._code.append(t?"true":"false");else if(typeof t=="function")t();else if(t instanceof s)this._code.append(t.toString());else{if(!t)throw e.createError(new Error('Illegal arg for method call "'+i+'": '+t.toString()+" ("+n+")"));this._code.append(t.toString())}},this),r<t.length-1?this._code.append(")\n"):this._code.append(");\n"),r!==0&&this.decIndent()},this))},incIndent:function(e){arguments.length===0&&(e=1),this.flush(),this._indent=this.indentStr(e),this.firstStatement=!0},decIndent:function(e){arguments.length===0&&(e=1),this.flush(),this._indent=this._indent.substring(n.length*e),this.firstStatement=!1},getOutput:function(){return this.flush(),this._code.toString()}};var a=function(e,n,r){this.resource=n,this.rootNode=r,this.compiler=e,this.rootNode&&(this.rootNode.compiler=e,this.rootNode.forEachNamespace(function(e,n){this.compiler.taglibs.isTaglib(n)||(t("raptor/templating/compiler").findAndLoadTaglib(n),this.compiler.taglibs.isTaglib(n)||this.rootNode.addError('Taglib with URI "'+n+'" (prefix: "'+e+'") not found.'))},this)),typeof n=="string"?(this.resource=null,this.filePath=this.path=n):t("raptor/resources").isResource(n)&&(this.filePath=n.getURL(),this.path=n.getPath()),this.options=e.options,this.templateName=null,this.attributes={},this.writer=new u,this.staticVars=[],this.staticVarsLookup={},this.helperFunctionsAdded={},this.vars=[],this.varsLookup={},this.getStaticHelperFunction("empty","e"),this.getStaticHelperFunction("notEmpty","ne")};return a.prototype={isTaglib:function(e){return this.rootNode.hasNamespacePrefix(e)},getTemplateName:function(){var e=this.options||{};return e.templateName||this.templateName||e.defaultTemplateName},_getHelperFunction:function(e,t,n){var r=t+":"+(n?"static":"context"),i=this.helperFunctionsAdded[r];return i?i:(n?this.addStaticVar(e,"helpers."+t):this.addVar(e,"contextHelpers."+t),this.helperFunctionsAdded[r]=e,e)},getContextHelperFunction:function(e,t){return this._getHelperFunction(e,t,!1)},captureCode:function(e,t){var n=this.writer,r=new u(n.indentStr());try{return this.writer=r,e.call(t),r.getOutput()}finally{this.writer=n}},getStaticHelperFunction:function(e,t){return this._getHelperFunction(e,t,!0)},hasStaticVar:function(e){return this.staticVarsLookup[e]===!0},addStaticVar:function(e,t){this.staticVarsLookup[e]||(this.staticVarsLookup[e]=!0,this.staticVars.push({name:e,expression:t}))},hasVar:function(e){return this.vars[e]===!0},addVar:function(e,t){this.vars[e]=!0,this.vars.push({name:e,expression:t})},_writeVars:function(e,t,n){if(!e.length)return;t.append(n+"var ");var r=[];o(e,function(t,i){r.push((i!==0?n+"    ":"")+t.name+" = "+t.expression+(i===e.length-1?";\n":",\n"))}),t.append(r.join(""))},text:function(e){return this.hasErrors()||this.writer.text(e),this},attr:function(e,t,n){return this.hasErrors()||(n===!1?this.contextMethodCall("a",r(e),t,!1):this.contextMethodCall("a",r(e),t)),this},attrs:function(e){return this.hasErrors()||this.contextMethodCall("a",e),this},include:function(e,t){return this.hasErrors()||this.contextMethodCall("i",e,t),this},contextMethodCall:function(e,t){return this.hasErrors()||this.writer.contextMethodCall.apply(this.writer,arguments),this},addClassNameVar:function(e){var t=e.replace(/[^a-zA-Z0-9]+/g,"_");return this.hasStaticVar(t)||this.addStaticVar(t,JSON.stringify(e)),t},addHelperFunction:function(e,t,n,r){var i=this.addClassNameVar(e);r||(r=t);if(n===!0){if(this.hasVar(r))return;this.addVar(r,"context.f("+i+","+JSON.stringify(t)+")")}else{if(this.hasStaticVar(r))return;this.addStaticVar(r,this.getStaticHelperFunction("getHelper","h")+"("+i+","+JSON.stringify(t)+")")}},write:function(e,t){return this.hasErrors()||(t&&(t.escapeXml&&(e=this.getStaticHelperFunction("escapeXml","x")+"("+e+")"),t.escapeXmlAttr&&(e=this.getStaticHelperFunction("escapeXmlAttr","xa")+"("+e+")")),this.writer.write(e)),this},incIndent:function(){return this.hasErrors()||this.writer.incIndent.apply(this.writer,arguments),this},decIndent:function(){return this.hasErrors()||this.writer.decIndent.apply(this.writer,arguments),this},code:function(e){return this.hasErrors()||this.writer.code(e),this},statement:function(e){return this.hasErrors()||this.writer.statement(e),this},line:function(e){return this.hasErrors()||this.writer.line(e),this},indentStr:function(e){return this.writer.indentStr(e)},indent:function(){return this.hasErrors()||this.writer.indent.apply(this.writer,arguments),this},getPath:function(){return this.path},getFilePath:function(){return this.filePath},getOutput:function(){if(this.hasErrors())return"";var e=i.createStringBuilder(),t=this.getTemplateName();t||this.addError('Template name not defined in template at path "'+this.getFilePath()+'"');var s=this.params;return s?s=["context"].concat(s):s=["context"],e.append('$rset("rhtml", '),e.append(r(t)),e.append(", "),e.append("function(helpers, templateInfo) {\n"),this.writer.flush(),this._writeVars(this.staticVars,e,n),e.append("\n"+n+"return function(data, context) {\n"),this.vars&&this.vars.length&&(this._writeVars(this.vars,e,n+n),e.append("\n")),e.append(this.writer.getOutput()),e.append(n+"}\n});"),e.toString()},setTemplateName:function(e){this.templateName=e},makeExpression:function(e){return e instanceof s?e:new s(e)},isExpression:function(e){return e instanceof s},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,t},hasErrors:function(){return this.compiler.hasErrors()},addError:function(e,t){this.compiler.addError(e,t)},getErrors:function(){return this.compiler.getErrors()},getNodeClass:function(e,t){return this.compiler.getNodeClass(e,t)},transformTree:function(e){this.compiler.transformTree(e,this)},INDENT:n},a});
define.Class("raptor/templating/compiler/TemplateCompiler",["raptor"],function(raptor,require,exports,module){"use strict";var TemplateBuilder=require("raptor/templating/compiler/TemplateBuilder"),ParseTreeBuilder=require("raptor/templating/compiler/ParseTreeBuilder"),Expression=require("raptor/templating/compiler/Expression"),minifier=require.exists("raptor/js-minifier")?require("raptor/js-minifier"):null,TypeConverter=require("raptor/templating/compiler/TypeConverter"),logger=module.logger(),TemplateCompiler=function(e,t){this.taglibs=e,this.options=t||{},this.workDir=this.options.workDir||require("raptor/templating/compiler").workDir||require("raptor/temp").workDir,this.errors=[]};return TemplateCompiler.prototype={transformTree:function(e,t){if(!t)throw raptor.createError(new Error("The templateBuilder argument is required"));var n=function(e){try{this.taglibs.forEachNodeTransformer(e,function(n){e.isTransformerApplied(n)||(e.setTransformerApplied(n),this._transformerApplied=!0,e.compiler=this,n.getInstance().process(e,this,t))},this)}catch(r){throw raptor.createError(new Error('Unable to compile template at path "'+t.filePath+". Error: "+r.message),r)}e.forEachChild(function(e){if(!e.parentNode)return;n.call(this,e)},this)};do this._transformerApplied=!1,n.call(this,e);while(this._transformerApplied)},compile:function(e,t,n,r){var i=this,s,o,u=function(){var e="Errors in template:\n",t=i.getErrors();for(var n=0,r=t.length;n<r;n++)e+=n+1+") "+(t[n].pos?"["+t[n].pos+"] ":"")+t[n].message+"\n";var s=new Error(e);throw s.errors=i.getErrors(),s},a;require("raptor/resources").isResource(t)?a=t.getURL():typeof t=="string"&&(a=t);try{s=ParseTreeBuilder.parse(e,a,this.taglibs),o=new TemplateBuilder(this,t,s),this.transformTree(s,o)}catch(f){throw raptor.createError(new Error('An error occurred while trying to compile template at path "'+a+'". Exception: '+f),f)}try{s.generateCode(o)}catch(f){throw raptor.createError(new Error('An error occurred while trying to compile template at path "'+a+'". Exception: '+f),f)}this.hasErrors()&&u();var l=o.getOutput();minifier&&this.options.minify===!0&&(l=minifier.minify(l)),n&&n.call(r,{source:l,templateName:o.getTemplateName()});var c=this.options;return c&&c.nameCallback&&c.nameCallback(o.getTemplateName()),l},compileAndLoad:function(e,t){var n=this.compile(e,t,function(e){require("raptor/templating").unload(e.templateName)});try{this._eval(n,t)}catch(r){var i;throw typeof t=="string"?i=t:require("raptor/resources").isResource(t)&&(i=t.getURL()),logger.error("Unable to load compiled template: "+n,r),raptor.createError(new Error('Unable to load template at path "'+i+'". Exception: '+r.message),r)}},_eval:function(compiledSrc,resource){eval(compiledSrc)},isExpression:function(e){return e instanceof Expression},createTagHandlerNode:function(e,t){var n=require("raptor/templating/taglibs/core/TagHandlerNode"),r=this.taglibs.getTag(e,t),i=new n(r);return i},convertType:function(e,t,n){return TypeConverter.convert(e,t,n)},addError:function(e,t){this.errors.push({message:e,pos:t})},hasErrors:function(){return this.errors.length!==0},getErrors:function(){return this.errors},getNodeClass:function(e,t){var n=this.taglibs.getTag(e,t);if(n&&n.nodeClass)return require(n.nodeClass);throw raptor.createError(new Error('Node class not found for uri "'+e+'" and localName "'+t+'"'))},createTag:function(){var e=require("raptor/templating/compiler/Taglib");return new e.Tag}},TemplateCompiler});
define.Class("raptor/templating/compiler/Taglib",["raptor"],function(e,t){"use strict";var n=function(){this.uri=null,this.shortName=null,this.aliases=[],this.tags={},this.textTransformers=[],this.attributeMap={},this.functions=[],this.helperObject=null,this.patternAttributes=[]};return n.prototype={addAttribute:function(t){if(t.uri)throw e.createError(new Error('"uri" is not allowed for taglib attributes'));t.name?this.attributeMap[t.name]=t:this.patternAttributes.push(t)},getAttribute:function(e){var t=this.attributeMap[e];if(!t)for(var n=0,r=this.patternAttributes.length;n<r;n++){var i=this.patternAttributes[n];i.pattern.test(e)&&(t=i)}return t},addTag:function(e){var t=(e.uri||"")+":"+e.name;e._taglib=this,this.tags[t]=e},addTextTransformer:function(e){this.textTransformers.push(e)},forEachTag:function(t,n){e.forEachEntry(this.tags,function(e,r){t.call(n,r)},this)},addFunction:function(e){this.functions.push(e)},setHelperObject:function(e){this.helperObject=e},getHelperObject:function(){return this.helperObject},addAlias:function(e){this.aliases.push(e)}},n.Tag=define.Class(function(){var t=function(){this.attributeMap={},this.transformers={},this.nestedVariables={},this.importedVariables={},this.nestedTags={},this.staticProperties={},this.patternAttributes=[],this._taglib=null};return t.prototype={inheritFrom:function(t){function r(t,n){e.forEachEntry(n,function(e,n){t[e]||(t[e]=n)})}var n=this;e.forEachEntry(t,function(e,t){n[e]===undefined&&(n[e]=t)}),["attributeMap","transformers","nestedVariables","importedVariables","nestedTags","staticProperties"].forEach(function(e){r(n[e],t[e])}),n.patternAttributes=t.patternAttributes.concat(n.patternAttributes)},addNestedTag:function(e){var t=e.uri||"";this.nestedTags[t+":"+e.name]=e},forEachNestedTag:function(t,n){e.forEachEntry(this.nestedTags,function(e,r){t.call(n,r)})},forEachVariable:function(t,n){e.forEachEntry(this.nestedVariables,function(e,r){t.call(n,r)})},forEachImportedVariable:function(t,n){e.forEachEntry(this.importedVariables,function(e,r){t.call(n,r)})},forEachTransformer:function(t,n){e.forEachEntry(this.transformers,function(e,r){t.call(n,r)})},forEachStaticProperty:function(t,n){e.forEachEntry(this.staticProperties,function(e,r){t.call(n,r)})},hasTransformers:function(){for(var e in this.transformers)return!0;return!1},addAttribute:function(e){if(e.pattern)this.patternAttributes.push(e);else{var t=e.uri||"";this.attributeMap[t+":"+e.name]=e}},getAttribute:function(e,t){e==null&&(e="");var n=this.attributeMap[e+":"+t]||this.attributeMap[e+":*"]||this.attributeMap["*:"+t]||this.attributeMap["*:*"];if(!n&&this.patternAttributes.length)for(var r=0,i=this.patternAttributes.length;r<i;r++){var s=this.patternAttributes[r];if(s.uri!==e)continue;s.pattern.test(t)&&(n=s)}return n},getTaglibUri:function(){if(!this._taglib)throw e.createError(new Error("Taglib not set for tag. (uri="+this.uri+", name="+this.name+")"));return this._taglib.uri},toString:function(){return"[Tag: <"+this.uri+":"+this.name+">]"},forEachAttribute:function(t,n){e.forEachEntry(this.attributeMap,function(e,r){t.call(n,r)})},addNestedVariable:function(e){var t=e.nameFromAttribute?"attr:"+e.nameFromAttribute:e.name;this.nestedVariables[t]=e},addImportedVariable:function(e){var t=e.targetProperty;this.importedVariables[t]=e},addTransformer:function(e){var t=e.className;this.transformers[t]=e},addStaticProperty:function(e){var t=e.name;this.staticProperties[t]=e}},t}),n.Attribute=define.Class(function(){var e=function(){this.name=null,this.uri=null,this.type=null,this.required=!1,this.type="string",this.allowExpressions=!0};return e.prototype={},e}),n.Property=define.Class(function(){var e=function(){this.name=null,this.type="string",this.value=undefined};return e.prototype={},e}),n.NestedVariable=define.Class(function(){var e=function(){this.name=null};return e.prototype={},e}),n.ImportedVariable=define.Class(function(){var e=function(){this.targetProperty=null,this.expression=null};return e.prototype={},e}),n.Transformer=define.Class(function(){var n=0,r=function(){this.id=n++,this.tag=null,this.className=null,this.after=null,this.before=null,this.instance=null,this.properties={}};return r.prototype={getInstance:function(){if(!this.className)throw e.createError(new Error("Transformer class not defined for tag transformer (tag="+this.tag+")"));if(!this.instance){var n=t(this.className);if(n.process)return n;this.instance=new n,this.instance.id=this.id}return this.instance},toString:function(){return"[Taglib.Transformer: "+this.className+"]"}},r}),n.Function=define.Class(function(){var e=function(){this.name=null,this.functionClass=null,this.bindToContext=!1};return e.prototype={},e}),n.HelperObject=define.Class(function(){var e=function(){this.className=null,this.moduleName=null};return e.prototype={},e}),n});
define.Class("raptor/templating/compiler/TaglibCollection",["raptor"],function(e,t,n,r){"use strict";var i=e.forEach,s=t("raptor/strings"),o=t("raptor/templating/compiler/ElementNode"),u=t("raptor/templating/compiler/TextNode"),a=/^(?:(\*|(?:(?:@?[A-Za-z0-9_\-]+\s*,\s*)*@?[A-Za-z0-9_\-]+))\s+from\s+)?([^ ]*)(?:\s+as\s+([A-Za-z0-9_\-]+))?$/,f=function(e,t,n){if(e[t]!=null)return e[t];var r=t.indexOf("-"),i,s,o;if(r!=-1){i=t.substring(0,r),o=t.substring(r+1),s=n._prefixes[i];if(s)return{uri:s,name:o,prefix:i}}return null},l=function(t,n){this._tagImports={},this._attrImports={},this._prefixes={};var r=s.trim(n).split(/\s*;\s*/);i(r,function(n){if(!n)return;var r=n.match(a),s,o={},u,f;if(!r)throw e.createError(new Error('Invalid import: "'+n+'"'));s=r[1],u=t.resolveURI(r[2]),f=r[3];if(!f){f=t.resolvePrefix(u)||t.resolveShortName(u);if(!f)throw e.createError(new Error('Unable to handle imports from "'+u+'". The taglib does not have a prefix or short name defined.'))}this._prefixes[f]=u,s&&i(s.split(/\s*,\s*/),function(e){o[e]=!0}),t.forEachTag(u,function(e,t){e.uri===u&&(o["*"]||o[e.name])&&(this._tagImports[e.name]={uri:u,name:e.name,prefix:f}),e.forEachAttribute(function(t){e.uri!==u&&(o["*"]||o["@"+t.name])&&(this._attrImports[t.name]={uri:u,name:t.name,prefix:f})},this)},this)},this)};l.prototype={getImportedTag:function(e){return f(this._tagImports,e,this)},getImportedAttribute:function(e){return f(this._attrImports,e,this)}};var c=function(){this.tagTransformersLookup={},this.tags={},this.textTransformers={},this.taglibsByURI={},this.uriToShortNameMapping={},this.aliases={},this.uriToPrefixMapping={},this.functionsLookup={},this.attributeLookup={},this.nestedTags={}};return c.prototype={getAttribute:function(t,n,r,i){var s=this.tags;t=this.resolveURI(t);var o=this.attributeLookup;r==null&&(r="");var u=function(e){var t=o[e+":"+r+":"+i]||o[e+":"+r+":*"]||o[e+":*:"+i]||o[e+":*:*"];if(!t){var n=s[e];n&&(t=n.getAttribute(r,i))}return t},a=u(t+":"+n)||u(t+":*")||u("*:*");if(a&&a.uri&&a.uri!=="*"){var f=this.taglibsByURI[a.uri];if(!f)throw e.createError(new Error('Taglib with URI "'+a.uri+'" not found for imported attribute with name "'+i+'"'));a=f.getAttribute(i);if(!a)throw e.createError(new Error('Attribute "'+i+'" imported from taglib with URI "'+a.uri+'" not found in taglib.'))}if(!a){var l=this.resolveShortName(r);if(l!==r)return this.getAttribute(t,n,l,i)}return a},forEachTag:function(t,n,r){t=this.resolveURI(t);var i=this.taglibsByURI[t];if(!i)return;e.forEachEntry(i.tags,function(e,t){n.call(r,t,i)})},isTaglib:function(e){return this.taglibsByURI[this.resolveURI(e)]!=null},add:function(t){var n=this.taglibsByURI[t.uri]||t;this.taglibsByURI[t.uri]=n,t.shortName&&t.shortName!=t.uri&&(this.taglibsByURI[t.shortName]=t,t.shortName&&(n.shortName=t.shortName,this.addAlias(t.uri,t.shortName),this.uriToShortNameMapping[t.uri]=t.shortName),t.prefix&&(n.prefix=t.prefix,this.uriToPrefixMapping[t.uri]=t.prefix)),t.aliases.forEach(function(e){this.addAlias(t.uri,e)},this),t.forEachTag(function(n,r){var i=n.uri==null?n.uri=t.uri:n.uri,s=n.name,o=i+":"+s;this.tags[o]=n;if(n.hasTransformers()){var u=this.tagTransformersLookup[o]||(this.tagTransformersLookup[o]=[]);n.forEachTransformer(function(t){if(!t)throw e.createError(new Error("Transformer is null"));u.push(t)},this)}n.forEachNestedTag(function(e){this.nestedTags[n.uri+":"+n.name+":"+e.uri+":"+e.name]=e},this),n.forEachAttribute(function(e){this.attributeLookup[n.uri+":"+n.name+":"+(e.uri||"")+":"+e.name]=e},this)},this),i(t.textTransformers,function(e){this.textTransformers[e.className]=e},this),i(t.functions,function(r){if(!r.name)throw e.createError(new Error("Function name not set."));this.functionsLookup[t.uri+":"+r.name]=r,n.shortName&&(this.functionsLookup[t.shortName+":"+r.name]=r)},this)},addAlias:function(e,t){this.aliases[t]=e},forEachNodeTransformer:function(e,t,n){e instanceof o?this.forEachTagTransformer(e.uri,e.localName,t,n):e instanceof u&&this.forEachTextTransformer(t,n)},resolveURI:function(e){if(!e)return e;var t;for(;;){t=this.aliases[e]||e;if(t===e)return t;e=t}},resolveShortName:function(e){return e?(e=this.resolveURI(e),this.uriToShortNameMapping[e]):e},resolvePrefix:function(e){return e?(e=this.resolveURI(e),this.uriToPrefixMapping[e]):e},forEachTagTransformer:function(t,n,r,i){t==null&&(t="");var s={},o=[],u={},a={},f=function(t){e.forEach(t,function(t){if(!t)throw e.createError(new Error("Invalid transformer"));s[t.className]||(s[t.className]=t,o.push(t),t.before&&(a[t.before]||(a[t.before]=[])).push(t))})};f(this.tagTransformersLookup["*:*"]),f(this.tagTransformersLookup[t+":*"]),f(this.tagTransformersLookup[t+":"+n]);var l=function(t){if(!u[t.className]){u[t.className]=!0;if(t.after){if(!s[t.after])throw e.createError(new Error('After transformers not found for "'+t.after+'"'));l(s[t.after])}e.forEach(a[t.className],l),r.call(i,t)}};o.forEach(function(e){l(e)},this)},forEachTextTransformer:function(t,n){e.forEachEntry(this.textTransformers,function(e,r){var i=t.call(n,r);return i===!1?!1:!0})},getTag:function(e,t){e=this.resolveURI(e);var n=this.tags[e+":"+t];return n||(n=this.tags[e+":*"]),n},getNestedTag:function(e,t,n,r){return e=e||"",n=n||"",this.nestedTags[e+":"+t+":"+n+":"+r]},getFunction:function(e,t){return this.functionsLookup[e+":"+t]},getHelperObject:function(e){e=this.resolveURI(e);var t=this.taglibsByURI[e];if(!t)throw new Error("Invalid taglib URI: "+e);return t.getHelperObject()},getImports:function(e){return new l(this,e)}},c});
define("raptor/templating/compiler",function(e,t,n){"use strict";var r=e("raptor/templating/compiler/TaglibCollection"),i=new r,s=e("raptor").extend,o=e("raptor/templating/compiler/ExpressionParser"),u={minify:!1,preserveWhitespace:{pre:!0,textarea:!0},allowSelfClosing:{},startTagOnly:{img:!0,br:!0,input:!0,meta:!0,link:!0,hr:!0}};return{createCompiler:function(t){this.discoverTaglibs&&this.discoverTaglibs();var n=e("raptor/templating/compiler/TemplateCompiler");return t?t=s(s({},u),t):t=u,new n(i,t)},compile:function(e,t,n){return this.createCompiler(n).compile(e,t)},compileAndLoad:function(e,t,n){this.createCompiler(n).compileAndLoad(e,t)},loadTaglibXml:function(t,n){var r=e("raptor/templating/compiler/TaglibXmlLoader"),i=r.load(t,n);return this.addTaglib(i),i},addTaglib:function(e){i.add(e)},addTaglibAlias:function(e,t){i.addAlias(e,t)},clearTaglibs:function(){this.taglibs=i=new r},hasTaglib:function(e){return i.isTaglib(e)},registerCustomExpressionHandler:function(e,t){o.custom[e]=t},recordLoadedTaglib:function(e){},defaultOptions:u,taglibs:i}});
define.Class("raptor/templating/compiler/Node",["raptor"],function(e,t){"use strict";var n=e.forEachEntry,r=e.forEach,i=Array.isArray,s=t("raptor/objects").isEmpty,o=function(e){this.nodeType||(this._isRoot=!1,this.preserveWhitespace=null,this.wordWrapEnabled=null,this.escapeXmlBodyText=null,this.escapeXmlContext=null,this.nodeType=e,this.parentNode=null,this.previousSibling=null,this.nextSibling=null,this.firstChild=null,this.lastChild=null,this.namespaceMappings={},this.prefixMappings={},this.transformersApplied={},this.properties={})};return o.prototype={setRoot:function(e){this._isRoot=e},getPosition:function(){var e=this.pos||this.getProperty("pos")||{toString:function(){return"(unknown position)"}};return e},setPosition:function(e){this.pos=e},addError:function(t){var n=this.compiler,r=this;while(r!=null&&!n){n=r.compiler;if(n)break;r=r.parentNode}if(!n)throw e.createError(new Error("Template compiler not set for node "+this));var i=this.getPosition();n.addError(t+" ("+this.toString()+")",i)},setProperty:function(e,t){this.setPropertyNS(null,e,t)},setPropertyNS:function(e,t,n){e||(e="");var r=this.properties[e];r||(r=this.properties[e]={}),r[t]=n},setProperties:function(e){this.setPropertiesNS(null,e)},setPropertiesNS:function(e,t){e||(e=""),n(t,function(t,n){this.setPropertyNS(e,t,n)},this)},getPropertyNamespaces:function(){return Object.keys(this.properties)},getProperties:function(e){return this.getPropertiesNS(null)},hasProperty:function(e){return this.hasPropertyNS("",e)},hasPropertyNS:function(e,t){e||(e="");var n=this.properties[e];return n.hasOwnProperty(t)},getPropertiesByNS:function(){return this.properties},getPropertiesNS:function(e){return e||(e=""),this.properties[e]},forEachProperty:function(e,t){n(this.properties,function(r,i){n(i,function(n,i){e.call(t,r,n,i)},this)},this)},getProperty:function(e){return this.getPropertyNS(null,e)},getPropertyNS:function(e,t){e||(e="");var n=this.properties[e];return n?n[t]:undefined},removeProperty:function(e){this.removePropertyNS("",e)},removePropertyNS:function(e,t){e||(e="");var n=this.properties[e];n&&delete n[t],s(n)&&delete this.properties[e]},removePropertiesNS:function(e){delete this.properties[e]},forEachPropertyNS:function(e,t,r){e==null&&(e="");var i=this.properties[e];i&&n(i,function(e,n){t.call(r,e,n)},this)},forEachChild:function(e,t){if(!this.firstChild)return;var n=[],r=this.firstChild;while(r)n.push(r),r=r.nextSibling;for(var i=0,s=n.length;i<s;i++){r=n[i];if(r.parentNode===this&&!1===e.call(t,r))return}},getExpression:function(t,n,r,i){if(!t)throw e.createError(new Error("template argument is required"));var s=this;return t.makeExpression({toString:function(){return t.captureCode(function(){i?t.code("function() {\n").code(t.indentStr(2)+"return context."+(r!==!1?"captureString":"c")+"(function() {\n").indent(3,function(){n===!0?s.generateCodeForChildren(t):s.generateCode(t)}).code(t.indentStr(2)+"});\n").code(t.indentStr()+"}"):t.code("context."+(r!==!1?"captureString":"c")+"(function() {\n").indent(function(){n===!0?s.generateCodeForChildren(t):s.generateCode(t)}).code(t.indentStr()+"})")})}})},getBodyContentExpression:function(e,t){return this.getExpression(e,!0,t,!1)},getBodyContentFunctionExpression:function(e,t){return this.getExpression(e,!0,t,!0)},isTransformerApplied:function(e){return this.transformersApplied[e.id]===!0},setTransformerApplied:function(e){this.transformersApplied[e.id]=!0},hasChildren:function(){return this.firstChild!=null},appendChild:function(e){e.parentNode&&e.parentNode.removeChild(e),this.firstChild?(this.lastChild.nextSibling=e,e.previousSibling=this.lastChild,this.lastChild=e):(this.firstChild=this.lastChild=e,e.nextSibling=null,e.previousSibling=null),e.parentNode=this},appendChildren:function(t){if(!t)return;e.forEach(t,function(e){this.appendChild(e)},this)},isRoot:function(){return this._isRoot===!0},detach:function(){this.parentNode&&this.parentNode.removeChild(this)},removeChild:function(e){if(e.parentNode!==this)return null;var t=e.previousSibling,n=e.nextSibling;return this.firstChild===e&&this.lastChild===e?this.firstChild=this.lastChild=null:this.firstChild===e?(this.firstChild=this.firstChild.nextSibling,this.firstChild.previousSibling=null):this.lastChild===e?(this.lastChild=this.lastChild.previousSibling,this.lastChild.nextSibling=null):(t.nextSibling=n,n.previousSibling=t),e.parentNode=null,e.previousSibling=null,e.nextSibling=null,e},removeChildren:function(){while(this.firstChild)this.removeChild(this.firstChild)},replaceChild:function(e,t){return e===t?!1:t?t.parentNode!==this?!1:(this.firstChild===t&&this.lastChild===t?(this.firstChild=e,this.lastChild=e,e.previousSibling=null,e.nextSibling=null):this.firstChild===t?(e.nextSibling=t.nextSibling,t.nextSibling.previousSibling=e,this.firstChild=e):this.lastChild===t?(e.previousSibling=t,t.previousSibling.nextSibling=e,this.lastChild=e):(t.nextSibling.previousSibling=e,t.previousSibling.nextSibling=e,e.nextSibling=t.nextSibling,e.previousSibling=t.previousSibling),e.parentNode=this,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,!0):!1},insertAfter:function(t,n){return t?n&&n.parentNode!==this?!1:i(t)?(e.forEach(t,function(e){this.insertAfter(e,n),n=e},this),!0):t===n?!1:n===this.lastChild?(this.appendChild(t),!0):(t.parentNode&&t.parentNode.removeChild(t),!n||n===this.lastChild?(this.appendChild(t),!0):(n.nextSibling.previousSibling=t,t.nextSibling=n.nextSibling,t.previousSibling=n,n.nextSibling=t,t.parentNode=this,!0)):!1},insertBefore:function(e,t){if(!e)return!1;if(t&&t.parentNode!==this)return!1;if(i(e)){var n=e,r;for(r=n.length-1;r>=0;r--)this.insertBefore(n[r],t),t=n[r];return!0}return e===t?!1:(e.parentNode&&e.parentNode.removeChild(e),t?this.firstChild===t?(this.firstChild=e,this.firstChild.nextSibling=t,this.firstChild.previousSibling=null,t.previousSibling=this.firstChild,e.parentNode=this):this.insertAfter(e,t.previousSibling):this.appendChild(e),!0)},isTextNode:function(){return!1},isElementNode:function(){return!1},setStripExpression:function(e){this.stripExpression=e},generateCode:function(t){this.compiler=t.compiler;var n=this.isPreserveWhitespace();n==null&&(n=t.options.preserveWhitespace,n===!0||n&&n["*"]?this.setPreserveWhitespace(!0):this.setPreserveWhitespace(!1));var r=this.isWordWrapEnabled();r==null&&(r=t.options.wordWrapEnabled,r!==!1&&this.setWordWrapEnabled(!0)),this.isEscapeXmlBodyText()==null&&this.setEscapeXmlBodyText(!0);try{if(!this.stripExpression||this.stripExpression.toString()==="false")this.doGenerateCode(t);else if(this.stripExpression.toString()==="true")this.generateCodeForChildren(t);else{if(!this.generateBeforeCode||!this.generateAfterCode){this.addError("The c:strip directive is not supported for node "+this),this.generateCodeForChildren(t);return}var i=t.getAttribute("nextStripVarId");i==null&&(i=t.setAttribute("nextStripVarId",0));var s="__strip"+i++;t.statement("var "+s+" = !("+this.stripExpression+");"),t.statement("if ("+s+") {").indent(function(){this.generateBeforeCode(t)},this).line("}"),this.generateCodeForChildren(t),t.statement("if ("+s+") {").indent(function(){this.generateAfterCode(t)},this).line("}")}}catch(o){throw e.createError(new Error("Unable to generate code for node "+this+" at position ["+this.getPosition()+"]. Exception: "+o),o)}},isPreserveWhitespace:function(){return this.preserveWhitespace},setPreserveWhitespace:function(e){this.preserveWhitespace=e},isWordWrapEnabled:function(){return this.wordWrapEnabled},setWordWrapEnabled:function(e){this.wordWrapEnabled=e},doGenerateCode:function(e){this.generateCodeForChildren(e)},generateCodeForChildren:function(n,r){if(!n)throw e.createError(new Error('The "template" argument is required'));r===!0&&n.incIndent(),this.forEachChild(function(e){e.isPreserveWhitespace()==null&&e.setPreserveWhitespace(this.isPreserveWhitespace()===!0),e.isWordWrapEnabled()==null&&e.setWordWrapEnabled(this.isWordWrapEnabled()===!0),e.isEscapeXmlBodyText()==null&&e.setEscapeXmlBodyText(this.isEscapeXmlBodyText()!==!1),e.getEscapeXmlContext()==null&&e.setEscapeXmlContext(this.getEscapeXmlContext()||t("raptor/templating/compiler/EscapeXmlContext").Element),e.generateCode(n)},this),r===!0&&n.decIndent()},addNamespaceMappings:function(e){if(!e)return;var t=this.namespaceMappings,r=this.prefixMappings;n(e,function(e,n){t[e]=n,r[n]=e})},hasNamespacePrefix:function(e){return this.prefixMappings.hasOwnProperty(e)},resolveNamespacePrefix:function(e){var t=this.prefixMappings[e];return!t&&this.parentNode?this.parentNode.resolveNamespacePrefix():t},forEachNamespace:function(e,t){n(this.namespaceMappings,e,t)},getNodeClass:function(){return this.nodeClass||this.getClass()},setNodeClass:function(e){this.nodeClass=e},prettyPrintTree:function(){var e=[],t=function(n,r){e.push(r+n.toString()+"\n"),n.forEachChild(function(e){t(e,r+"  ")},this)};return t(this,""),e.join("")},setEscapeXmlBodyText:function(e){this.escapeXmlBodyText=e},isEscapeXmlBodyText:function(){return this.escapeXmlBodyText},setEscapeXmlContext:function(e){this.escapeXmlContext=e},getEscapeXmlContext:function(){return this.escapeXmlContext}},o});
define.Class("raptor/templating/compiler/ElementNode","raptor/templating/compiler/Node",["raptor"],function(e,t){"use strict";var n=e.forEachEntry,r=e.forEach,i=t("raptor/objects"),s=t("raptor/xml/utils").escapeXmlAttr,o="http://www.w3.org/XML/1998/namespace",u="http://www.w3.org/XML/1998/namespace",a=t("raptor/templating/compiler/ExpressionParser"),f=function(e,t,n){f.superclass.constructor.call(this,"element"),this._elementNode||(this._elementNode=!0,this.dynamicAttributesExpression=null,this.attributesByNS={},this.prefix=n,this.localName=this.tagName=e,this.uri=t,this.allowSelfClosing=!1,this.startTagOnly=!1)};return f.prototype={getQName:function(){return this.localName?(this.prefix?this.prefix+":":"")+this.localName:null},setStartTagOnly:function(e){this.startTagOnly=!0},setAllowSelfClosing:function(e){this.allowSelfClosing=e},isElementNode:function(){return!0},isTextNode:function(){return!1},getAllAttributes:function(){var e=[];return n(this.attributesByNS,function(t,r){n(r,function(t,n){e.push(n)})},this),e},forEachAttributeAnyNS:function(e,t){n(this.attributesByNS,function(r,i){n(i,function(n,r){e.call(t,r)})})},forEachAttributeNS:function(e,t,r){var i=this.attributesByNS[e||""];i&&n(i,function(e,n){t.call(r,n)})},getAttributes:function(){var e=[];return n(this.attributes,function(t,n){e.push(n)},this),e},getAttribute:function(e){return this.getAttributeNS(null,e)},getAttributeNS:function(e,t){var n=this.attributesByNS[e||""],r=n?n[t]:undefined;return r?r.value:undefined},setAttribute:function(e,t,n){this.setAttributeNS(null,e,t,null,n)},setAttributeNS:function(e,t,n,r,i){var s=this.attributesByNS[e||""]||(this.attributesByNS[e||""]={});s[t]={localName:t,value:n,prefix:r,uri:e,escapeXml:i,qName:r?r+":"+t:t,name:e?e+":"+t:t,toString:function(){return this.name}}},setEmptyAttribute:function(e){this.setAttribute(e,null)},removeAttribute:function(e){this.removeAttributeNS(null,e)},removeAttributeNS:function(e,t){var n=this.attributesByNS[e||""]||(this.attributesByNS[e||""]={});n&&(delete n[t],i.isEmpty(n)&&delete this.attributesByNS[e||""])},removeAttributesNS:function(e){delete this.attributesByNS[e||""]},isPreserveWhitespace:function(){var e=f.superclass.isPreserveWhitespace.call(this);if(e===!0)return!0;var t=this.getAttributeNS(o,"space")||this.getAttributeNS(u,"space")||this.getAttribute("xml:space")==="preserve";return t==="preserve"?!0:e},hasAttributesAnyNS:function(){return!i.isEmpty(this.attributesByNS)},hasAttributes:function(){return this.hasAttributesNS("")},hasAttributesNS:function(e){return this.attributesByNS[e||""]!==undefined},hasAttribute:function(e){return this.hasAttributeNS("",e)},hasAttributeNS:function(e,t){var n=this.attributesByNS[e||""];return n?n.hasOwnProperty(t):!1},removePreserveSpaceAttr:function(){this.removeAttributeNS(o,"space"),this.removeAttributeNS(u,"space"),this.removeAttribute("space")},setStripExpression:function(e){this.stripExpression=e},doGenerateCode:function(e){this.generateBeforeCode(e),this.generateCodeForChildren(e),this.generateAfterCode(e)},generateBeforeCode:function(t){var n=this.preserveWhitespace=this.isPreserveWhitespace(),i=this.prefix?this.prefix+":"+this.localName:this.localName;n&&this.removePreserveSpaceAttr(),t.text("<"+i),this.forEachAttributeAnyNS(function(n){var o=n.prefix;!o&&n.uri&&(o=this.resolveNamespacePrefix(n.uri)),o?i=o+(n.localName?":"+n.localName:""):i=n.localName;if(n.value===null||n.value===undefined)t.text(" "+i);else if(t.isExpression(n.value))t.attr(i,n.value,n.escapeXml!==!1);else{var u=[],f=!1,l=!1;a.parse(n.value,{text:function(e,t){u.push({text:e,escapeXml:t!==!1})},expression:function(e,t){f=!0,u.push({expression:e,escapeXml:t!==!1})},error:function(e){l=!0,this.addError('Invalid expression found in attribute "'+i+'". '+e)}},this),l?t.text(i+'="'+s(n.value)+'"'):f&&u.length===1?t.attr(i,u[0].expression,u[0].escapeXml!==!1):(t.text(" "+i+'="'),r(u,function(n){if(n.text)t.text(n.escapeXml!==!1?s(n.text):n.text);else{if(!n.expression)throw e.createError(new Error("Illegal state"));t.write(n.expression,{escapeXmlAttr:n.escapeXml!==!1})}}),t.text('"'))}},this),this.dynamicAttributesExpression&&t.attrs(this.dynamicAttributesExpression),this.hasChildren()?t.text(">"):this.startTagOnly?t.text(">"):this.allowSelfClosing&&t.text("/>")},generateAfterCode:function(e){var t=this.prefix?this.prefix+":"+this.localName:this.localName;this.hasChildren()?e.text("</"+t+">"):!this.startTagOnly&&!this.allowSelfClosing&&e.text("></"+t+">")},toString:function(){return"<"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">"}},f});
define.Class("raptor/templating/compiler/TextNode","raptor/templating/compiler/Node",["raptor"],function(e,t){"use strict";var n=t("raptor/xml/utils").escapeXml,r=/[&<>\"\']/g,i={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},s=function(e){return e.replace(r,function(e){return i[e]})},o=t("raptor/templating/compiler/EscapeXmlContext"),u=function(t,n){u.superclass.constructor.call(this,"text");if(t!=null&&typeof t!="string")throw e.createError("Invalid text: "+t);this.text=t,this.escapeXml=n!==!1};return u.prototype={normalizeText:function(){var e=this.getEscapedText(),t=this.nextSibling,n;while(t&&t.isTextNode())e+=t.getEscapedText(),n=t,t=t.nextSibling,n.detach();this.setText(e),this.escapeXml=!1},getEscapedText:function(){var e=this.getText(),t=this.parentNode,r=this.escapeXml!==!1&&t&&t.isEscapeXmlBodyText()!==!1;return r?this.getEscapeXmlContext()===o.Attribute?s(e):n(e):e},trim:function(){var e=this.getText();if(!e)return;var t=this.parentNode;if(t&&t.trimBodyIndent){var n=/^\s+/.exec(e);if(n){var r=/\n[^\n]*$/.exec(n[0]);if(r){var i=new RegExp(r[0].replace(/\n/g,"\\n"),"g");e=e.replace(i,"\n")}e=e.replace(/^\s*/,"").replace(/\s*$/,""),this.setText(e)}}if(this.isPreserveWhitespace())return;this.previousSibling||(e=e.replace(/^\n\s*/g,"")),this.nextSibling||(e=e.replace(/\n\s*$/g,"")),/^\n\s*$/.test(e)&&(e=""),e=e.replace(/\s+/g," ");if(this.isWordWrapEnabled()&&e.length>80){var s=0,o;while(s<e.length){o=Math.min(s+80,e.length);var u=e.substring(s,o).lastIndexOf(" ");u!=-1?u+=s:u=e.indexOf(" ",o);if(u==-1)break;e=e.substring(0,u)+"\n"+e.substring(u+1),s=u+1}}this.setText(e)},doGenerateCode:function(e){this.normalizeText(),this.trim();var t=this.getText();t&&e.text(t)},getText:function(){return this.text},setText:function(e){this.text=e},isTextNode:function(){return!0},isElementNode:function(){return!1},setEscapeXml:function(e){this.escapeXml=e},isEscapeXml:function(){return this.escapeXml},toString:function(){var e=this.text&&this.text.length>25?this.text.substring(0,25)+"...":this.text;return e=e.replace(/[\n]/g,"\\n"),"[text: "+e+"]"}},u});
define.Class("raptor/templating/compiler/ParseTreeBuilder",["raptor"],function(e,t,n,r){"use strict";var i=r.logger(),s=t("raptor/xml/sax"),o=e.forEach,u=t("raptor/templating/compiler/TextNode"),a=t("raptor/templating/compiler/ElementNode"),f=function(){};return f.parse=function(e,t,n){var r=new f;return r.parse(e,t,n)},f.prototype={parse:function(t,n,r){var i=i,f=null,l=null,c=null,h,p=s.createParser({trim:!1,normalize:!1,dom:t.documentElement!=null}),d=function(e,t){if(!f)return;c?c.text+=e:(c=new u(e),c.pos=p.getPos(),f.appendChild(c))};return p.on({error:function(t){throw e.createError(t)},characters:function(e){d(e,!1)},cdata:function(e){d(e,!0)},startElement:function(e){c=null;var t,n,i,s=new a(e.getLocalName(),r.resolveURI(e.getNamespaceURI()),e.getPrefix());s.addNamespaceMappings(e.getNamespaceMappings()),s.pos=p.getPos(),o(e.getAttributes(),function(e){e.getLocalName()==="imports"&&!e.getNamespaceURI()&&(t=e.getValue())},this),f?f.appendChild(s):(l=s,t&&(h=r.getImports(t))),o(e.getAttributes(),function(e){var t=r.resolveURI(e.getNamespaceURI()),i=e.getLocalName(),o=e.getPrefix();!t&&h&&(n=h.getImportedAttribute(i))&&(t=n.uri,i=n.name,o=n.prefix),s.setAttributeNS(t,i,e.getValue(),o)},this),!s.uri&&h&&(i=h.getImportedTag(s.localName))&&(s.uri=i.uri,s.localName=i.name,s.prefix=i.prefix),f=s},endElement:function(){c=null,f=f.parentNode}},this),p.parse(t,n),l.setRoot(!0),l},getRootNode:function(){return this.rootNode}},f});
define.Class("raptor/templating/compiler/TaglibXmlLoader",["raptor"],function(e,t,n,r){"use strict";var i=t("raptor/xml/sax/object-mapper"),s=r.logger(),o=t("raptor/regexp"),u=t("raptor/templating/compiler/Taglib"),a=u.Tag,f=u.Attribute,l=u.Property,c=u.NestedVariable,h=u.ImportedVariable,p=u.Transformer,d=u.Function,v=u.HelperObject,m="string",g="boolean",y="object",b=function(e,t){this.src=e,this.filePath=typeof t=="string"?t:t.getURL(),this.resource=t};return b.load=function(e,t){var n=new b(e,t);return n.load()},b.prototype={load:function(){var n=this.src,r=this.filePath,s=this.resource,b={},w=function(t){var n=t["extends"];if(!n)return;delete t["extends"];var i=b[n];if(!i)throw e.createError(new Error('Parent tag with ID "'+n+'" not found in taglib at path "'+r+'"'));i["extends"]&&w(i),t.inheritFrom(i)},E,S={_type:y,_begin:function(){return new f},_end:function(e,t){e.uri==null&&(e.uri=""),t.addAttribute(e)},name:{_type:m},pattern:{_type:m,_set:function(e,t,n){var r=o.simple(n);e.pattern=r}},"target-property":{_type:m,_targetProp:"targetProperty"},uri:{_type:m},deprecated:{_type:m},required:{_type:g},type:{_type:m},"allow-expressions":{_type:g,_targetProp:"allowExpressions"},"preserve-name":{_type:g,_targetProp:"preserveName"},description:{_type:m}},x={_type:y,_begin:function(){return new h},_end:function(t,n){t.name&&(t.targetProperty||(t.targetProperty=t.name),t.expression=t.name,delete t.name);if(!t.targetProperty)throw e.createError(new Error('The "target-property" attribute is required for an imported variable'));if(!t.expression)throw e.createError(new Error('The "expression" attribute is required for an imported variable'));n.addImportedVariable(t)},name:{_type:m},"target-property":{_type:m,_targetProp:"targetProperty"},expression:{_type:m}},T={_type:y,_begin:function(){return new c},_end:function(t,n){if(!t.name&&!t.nameFromAttribute)throw e.createError(new Error('The "name" or "name-from-attribute" attribute is required for a nested variable'));n.addNestedVariable(t)},name:{_type:m,_targetProp:"name"},"name-from-attribute":{_type:m,_targetProp:"nameFromAttribute"},"name-from-attr":{_type:m,_targetProp:"nameFromAttribute"}},N={"raptor-taglib":{_type:y,_begin:function(){var e=new u;return E||(E=e),e},attribute:S,"tlib-version":{_type:m,_targetProp:"version"},"short-name":{_type:m,_targetProp:"shortName"},uri:{_type:m,_set:function(e,t,n,r){e.uri?e.addAlias(n):e.uri=n}},prefix:{_type:m},tag:{_type:y,_begin:function(){return new a},_end:function(e){e.uri===undefined&&(e.uri=E.uri),E.addTag(e),e.id&&(b[e.id]=e)},name:{_type:m,_targetProp:"name"},uri:{_type:m,_set:function(e,t,n,r){e.uri=n||""}},id:{_type:m},preserveSpace:{_type:g,_targetProp:"preserveWhitespace"},"preserve-space":{_type:g,_targetProp:"preserveWhitespace"},"preserve-whitespace":{_type:g,_targetProp:"preserveWhitespace"},preserveWhitespace:{_type:g,_targetProp:"preserveWhitespace"},"extends":{_type:m,_targetProp:"extends"},"handler-class":{_type:m,_targetProp:"handlerClass"},renderer:{_type:m,_targetProp:"handlerClass"},template:{_type:m,_targetProp:"template"},"node-class":{_type:m,_targetProp:"nodeClass"},"dynamic-attributes":{_type:g,_targetProp:"dynamicAttributes"},"dynamic-attributes-remove-dashes":{_type:g,_targetProp:"dynamicAttributesRemoveDashes"},"<attribute>":S,"<static-property>":{_type:y,_begin:function(){return new l},_end:function(t,n){if(!t.name)throw e.createError(new Error('The "name" property is required for a <static-property>'));if(!t.hasOwnProperty("value"))throw e.createError(new Error('The "value" property is required for a <static-property>'));n.addStaticProperty(t)},name:{_type:m},type:{_type:m},value:{_type:m}},"<nested-tag>":{_type:y,_begin:function(){return new a},_end:function(t,n){if(t.uri===null||t.uri===undefined)t.uri=E.uri;t.targetProperty=t.targetProperty||t.name;if(!t.name)throw e.createError(new Error('The "name" property is required for a <nested-tag>'));n.addNestedTag(t)},name:{_type:m},type:{_type:m},"target-property":{_type:m,_targetProp:"targetProperty"}},"nested-variable":T,variable:T,"imported-variable":x,"import-variable":x,"transformer-class":{_type:m,_set:function(e,t,n){var r=new p;r.className=n,e.addTransformer(r)}},transformer:{_type:y,_begin:function(){return new p},_end:function(e,t){t.addTransformer(e)},"class-name":{_type:m,_targetProp:"className"},after:{_type:m,_targetProp:"after"},before:{_type:m,_targetProp:"before"},"<properties>":{_type:y,_begin:function(e){return e.properties={}},"<*>":{_type:m}}}},"text-transformer":{_type:y,_begin:function(){return new p},_end:function(e){E.addTextTransformer(e)},"class-name":{_type:m,_targetProp:"className"}},"import-taglib":{_type:y,_begin:function(){return{}},_end:function(n){var o=n.path,u,a;o.startsWith("/")?a=t("raptor/resources").findResource(o):a=s.resolve(o);if(!a.exists())throw e.createError(new Error('Imported taglib with path "'+o+'" not found in taglib at path "'+r+'"'));t("raptor/templating/compiler").recordLoadedTaglib(a),u=a.readAsString(),i.read(u,a.getURL(),N)},path:{_type:m}},"function":{_type:y,_begin:function(){return new d},_end:function(e){E.addFunction(e)},name:{_type:m},"class":{_type:m,_targetProp:"functionClass"},"bind-to-context":{_type:g,_targetProp:"bindToContext"}},"helper-object":{_type:y,_begin:function(){return new v},_end:function(e){E.setHelperObject(e)},"module-name":{_type:m,_targetProp:"moduleName"},"class-name":{_type:m,_targetProp:"className"}}}};return i.read(n,r,N),E.forEachTag(function(e){w(e)}),E}},b});
define.Enum("raptor/templating/compiler/EscapeXmlContext",["Element","Attribute"]);
define.extend("raptor/templating/compiler",function(e,t){"use strict";var n=e("raptor"),r=!1;return{discoverTaglibs:function(){if(r)return;r=!0;var t=$rget("rtld");n.forEach(t,function(t){var n=e("raptor/resources").findResource(t);n&&n.exists()&&this.loadTaglibXml(n.readAsString(),n.getPath())},this)}}});